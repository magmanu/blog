{
    "version": "https://jsonfeed.org/version/1",
    "title": "Code, Cloud, App Security and more",
    "home_page_url": "https://magmanu.github.io/blog/pt-BR/tech",
    "description": "A Journey in Tech",
    "items": [
        {
            "id": "https://magmanu.github.io/blog/pt-BR/tech/github-actions-data-flow",
            "content_html": "<p>Quando se trata de Github Actions, os dados n√£o s√£o persistentes por natureza, nem ficam dispon√≠veis para todo o pipeline. Cada etapa (step) tem seu pr√≥prio processo, cada trabalho (job) tem seu pr√≥prio executor (runner). Por padr√£o, quaisquer dados que surjam em um trabalho terminam com ele.</p>\n<p>Ent√£o, como podemos passar dados de um processo para outro, ou salvar dados para uma execu√ß√£o futura?</p>\n<p>A resposta r√°pida e certeira √© essa:</p>\n<table><thead><tr><th>Estrat√©gia</th><th>Dados</th><th>Escopo</th><th>Persist√™ncia</th><th>Detalhes</th><th>Exemplo</th></tr></thead><tbody><tr><td><code>env</code></td><td>Valores</td><td>Trabalho (interno)</td><td>Ef√™mero</td><td>Propaga <em>dados</em> <br> entre <em>etapas</em> <br> no mesmo <em>trabalho</em></td><td>Passar um booleano para determinar se a pr√≥xima estapa deve ser executada</td></tr><tr><td><code>outputs</code></td><td>Valores</td><td>Fluxo de trabalho (interno)</td><td>Ef√™mero</td><td>Propaga <em>dados</em> <br> entre <em>trabalhos/etapas</em> <br> no mesmo <em>fluxo de trabalho</em></td><td>Passar um ID  para o pr√≥ximo trabalho</td></tr><tr><td>artefatos</td><td>Arquivos</td><td>Fluxo de trabalho (interno e externo)</td><td>Persistente</td><td>Propaga <em>arquivos</em> <br> entre <em>trabalhos/fluxos de trabalho</em></td><td>Passar o build de um projeto para diferentes trabalhos de teste executados em paralelo <br><br> <em>Prefer√™ncia a dados que mudam frequentemente. Os arquivos ficam dispon√≠veis para download ap√≥s o t√©rmino do fluxo de trabalho.</em></td></tr><tr><td>cache</td><td>Arquivos</td><td>Fluxo de trabalho (interno e externo)</td><td>Persistente</td><td>Propaga <em>arquivos</em> <br> dentro e entre <em>fluxos de trabalho</em> <br> no mesmo <em>reposit√≥rio</em></td><td>Armazenar pacotes npm em cache para uso em diferentes execu√ß√µes de fluxo de trabalho. <br><br> <em>Destinado a arquivos que n√£o mudam muito.</em></td></tr></tbody></table>\n<p>Para uma resposta mais completa, continue lendo.\nTodos os exemplos de fluxo de trabalho neste artigo ‚Äã‚Äã<a href=\"https://github.com/magmanu/blog/tree/main/demos/github-actions-data-flow\" target=\"_blank\" rel=\"noopener noreferrer\">est√£o disponiveis em formato de arquivo aqui</a>, junto com uma c√≥pia dos respectivos logs editados (em ingl√™s).</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"como-usar-env\">Como usar <code>env</code><a href=\"https://magmanu.github.io/blog/pt-BR/tech/github-actions-data-flow#como-usar-env\" class=\"hash-link\" aria-label=\"Link direto para como-usar-env\" title=\"Link direto para como-usar-env\">‚Äã</a></h2>\n<p>√â muito simples transferir dados entre etapas: defina um par chave-valor (key/value) e grave-o no arquivo de ambiente <code>GITHUB_ENV</code>, usando a sintaxe apropriada para seu shell. Veja exemplos abaixo em bash e python:</p>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Exibir c√≥digo</p></summary><div><div class=\"collapsibleContent_i85q\"><div><div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">/.github/workflows/using_env.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Duas formas de definir vari√°veis de ambiente</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># Aviso: nesta etapa, o input n√£o foi sanitizado nem validado</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">shell</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> bash</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          # N√£o exibe a vari√°vel nos logs.</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          wikipedia_aleatorio_1=$(curl -L -X GET \"https://en.wikipedia.org/api/rest_v1/page/random/summary\" | jq .title)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"$wikipedia_aleatorio_1\"</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"ARTIGO_1=$wikipedia_aleatorio_1\" &gt;&gt; \"$GITHUB_ENV\"</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          # üêâ Exibe a vari√°vel nos logs: use apenas com dados que n√£o sejam confidenciais!</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          wikipedia_aleatorio_2=$(curl -L -X GET \"https://en.wikipedia.org/api/rest_v1/page/random/summary\" | jq .title)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"ARTIGO_2=$wikipedia_aleatorio_2\" | tee -a \"$GITHUB_ENV\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Definir vari√°veis de ambiente em python</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">shell</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> python</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># se usar \"write\", use \\n ao criar mais de uma vari√°vel</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># com \"print\", \\n n√£o √© necess√°rio</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          from os import environ as env</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          with open(env.get('GITHUB_ENV', None), 'a') as ghenv:</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">            ghenv.write(\"SUJEITO=Sun\\n\")</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">            print(\"ESTADO=radiant\", file=ghenv)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">            print(\"DIA=today\", file=ghenv)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> üõ°Ô∏è Recuperando valores de forma segura</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># observe que ARTIGO_1 n√£o foi sanitizado ou validado, por isso, est√° vulner√°vel a ataques de inje√ß√£o.</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># A abordagem abaixo evita o problema ao passar ARTIGO_1 como argumento para o script.</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># Tamb√©m √© poss√≠vel renamear as vari√°veis</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">env</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">QUEM</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> env.SUJEITO </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">QUE</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> env.ARTIGO_1 </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">QUANDO</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> env.DIA </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"$QUEM leu sobre $QUE $QUANDO.\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> üêâ Recuperando valores de forma potencialmente vulner√°vel</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># Esta abordagem √© vulner√°vel a ataques de inje√ß√£o!</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># Use apenas se voc√™ tiver controle sobre o input</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">shell</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> bash</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"${{ env.SUJEITO }} est√° ${{ env.ESTADO }} ${{ env.DIA }}.\"</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div></div></div></div></details>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"dica-de-debug\">Dica de debug<a href=\"https://magmanu.github.io/blog/pt-BR/tech/github-actions-data-flow#dica-de-debug\" class=\"hash-link\" aria-label=\"Link direto para Dica de debug\" title=\"Link direto para Dica de debug\">‚Äã</a></h4>\n<p>Para listar todas as vari√°veis ‚Äã‚Äãde ambiente dispon√≠veis em um trabalho, adicione esta pequena etapa:</p>\n<p><code>- run: env</code></p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"como-usar-outputs\">Como usar <code>outputs</code><a href=\"https://magmanu.github.io/blog/pt-BR/tech/github-actions-data-flow#como-usar-outputs\" class=\"hash-link\" aria-label=\"Link direto para como-usar-outputs\" title=\"Link direto para como-usar-outputs\">‚Äã</a></h2>\n<p>Os outputs ficam dispon√≠veis para todas as etapas do mesmo trabalho e para qualquer trabalho subsequente que precise deles.\nOutputs sempre s√£o <strong>strings</strong> unicode.</p>\n<p>E obviamente, trabalhos que dependem de um <code>output</code> n√£o ser√£o executados em paralelo com o trabalho que produz o output.</p>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Mostrar c√≥digo</p></summary><div><div class=\"collapsibleContent_i85q\"><div><p>Para simplificar, o output foi definido em bash, mas voc√™ pode usar o shell que preferir.</p><div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">/.github/workflows/outputs-for-different-job.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token key atrule\" style=\"color:#00a4db\">jobs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">definicao-de-output</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">outputs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># Obrigat√≥rio: defina o output no trabalho para que fique dispon√≠vel a outros trabalhos</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">nome</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> steps.valor</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">estatico.outputs.NOME </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">lugar</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> steps.valor</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">dinamico.outputs.LUGAR </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">id</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> valor</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">estatico</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"NOME=Marcela\" &gt;&gt; \"$GITHUB_OUTPUT\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">id</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> valor</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">dinamico</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># Observe o use de jq -c para obter o valor como uma √∫nica linha</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          lugar=$(curl -H \"Accept: application/json\" https://randomuser.me/api/ | jq -c .results[].lugar)</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"LUGAR=$lugar\" &gt; \"$GITHUB_OUTPUT\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">recuperacao-de--outputs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">needs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> definicao</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">de</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">output</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> boas</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">vindas</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          PAIS=$(echo $GEODATA | jq -r . | jq .PAIS)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"Ol√° $nome! $PAIS √©/s√£o um lindo pa√≠s, divirta-se!\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">env</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">needs.definicao</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">de</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">output.outputs.nome</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">GEODATA</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> needs.definicao</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">de</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">output.outputs.lugar </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div></div></div></div></details>\n<p>Embora seja recomendado usar <code>env</code> para passar dados entre etapas, <code>outputs</code> tamb√©m pode ser usado. Isso √© √∫til quando um valor √© necess√°rio tanto no trabalho atual quanto nos trabalhos a seguir.</p>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Mostrar c√≥digo</p></summary><div><div class=\"collapsibleContent_i85q\"><div><p>O exemplo anterior mostrou como usar outputs em diferentes trabalhos.\nPara usar um output no trabalho em que ele √© definido, basta adicionar o c√≥digo em destaque abaixo.</p><div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">/.github/workflows/outputs-for-same-job.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token key atrule\" style=\"color:#00a4db\">jobs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">definicao-de-output</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">outputs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> steps.valor</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">estatico.outputs.NOME </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">lugar</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> steps.valor</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">dinamico.outputs.LUGAR </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">id</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> valor</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">estatico</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"NOME=Marcela\" &gt;&gt; \"$GITHUB_OUTPUT\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Consumir o output no mesmo trabalho</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"$NOME, $GEODATA √© sua localiza√ß√£o. Atualizamos seu fuso hor√°rio para GMT$OFFSET.\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">env</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">NOME</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> steps.valor</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">estatico.outputs.NOME </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># Use fromJSON() direto no env ao filtrar o valor do output ainda no env</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># Veja mais sobre filtragem de objetos em  </span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># https://docs.github.com/en/actions/learn-github-actions/expressions#object-filters</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">GEODATA</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> fromJSON(steps.valor</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">dinamico.outputs.LUGAR).country </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">OFFSET</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> fromJSON(steps.valor</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">dinamico.outputs.LUGAR).timezone.offset </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    (</span><span class=\"token punctuation\" style=\"color:#393A34\">...</span><span class=\"token plain\">)</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div></div></div></div></details>\n<div class=\"theme-admonition theme-admonition-info admonition_xJq3 alert alert--info\"><div class=\"admonitionHeading_Gvgb\"><span class=\"admonitionIcon_Rf37\"><svg viewBox=\"0 0 14 16\"><path fill-rule=\"evenodd\" d=\"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z\"></path></svg></span>Dica de debug</div><div class=\"admonitionContent_BuS1\"><ul>\n<li>Um output individual deve ter no m√°ximo 1 MB.</li>\n<li>Todos os outputs combinados n√£o devem exceder 50MB.</li>\n</ul></div></div>\n<br>\n<div class=\"theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success\"><div class=\"admonitionHeading_Gvgb\"><span class=\"admonitionIcon_Rf37\"><svg viewBox=\"0 0 12 16\"><path fill-rule=\"evenodd\" d=\"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z\"></path></svg></span>XP da vida Real</div><div class=\"admonitionContent_BuS1\"><p><code>GITHUB_OUTPUT</code> espera uma string de apenas uma linha.\nSe precisar de um output com v√°rias linhas, atribua-as a uma vari√°vel e construa o output assim:</p><div class=\"language-bash codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-bash codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token builtin class-name\">echo</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"NOME_DO_PAYLOAD&lt;&lt;EOF\"</span><span class=\"token string\" style=\"color:#e3116c\">$'</span><span class=\"token string entity\" style=\"color:#36acaa\">\\n</span><span class=\"token string\" style=\"color:#e3116c\">'</span><span class=\"token plain\">\"</span><span class=\"token variable\" style=\"color:#36acaa\">$valor_do_payload</span><span class=\"token string\" style=\"color:#e3116c\">\"$'</span><span class=\"token string entity\" style=\"color:#36acaa\">\\n</span><span class=\"token string\" style=\"color:#e3116c\">'EOF &gt;&gt; \"</span><span class=\"token variable\" style=\"color:#36acaa\">$GITHUB_OUTPUT</span><span class=\"token plain\">\".</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div></div></div>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"como-usar--artefatos\">Como usar  artefatos<a href=\"https://magmanu.github.io/blog/pt-BR/tech/github-actions-data-flow#como-usar--artefatos\" class=\"hash-link\" aria-label=\"Link direto para Como usar  artefatos\" title=\"Link direto para Como usar  artefatos\">‚Äã</a></h2>\n<p>A documenta√ß√£o diz: <em>Use artefatos quando desejar salvar arquivos produzidos por um trabalho para visualiza√ß√£o ap√≥s o t√©rmino da execu√ß√£o do fluxo de trabalho, como bin√°rios compilados ou logs de compila√ß√£o</em>. (tradu√ß√£o livre)</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"subir-artefatos\">Subir artefatos<a href=\"https://magmanu.github.io/blog/pt-BR/tech/github-actions-data-flow#subir-artefatos\" class=\"hash-link\" aria-label=\"Link direto para Subir artefatos\" title=\"Link direto para Subir artefatos\">‚Äã</a></h3>\n<p>Voc√™ pode:</p>\n<ul>\n<li>selecionar um ou v√°rios arquivos para serem agrupados como um artefato.</li>\n<li>usar curingas (wildcards), v√°rios caminhos (paths) e padr√µes (patterns) de exclus√£o com a sintaxe de sempre do GitHub Actions.</li>\n<li>definir um per√≠odo de reten√ß√£o para o artefato.</li>\n</ul>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">/.github/workflows/handle-artefacts.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token key atrule\" style=\"color:#00a4db\">jobs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">upload</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Checkout</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">uses</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> actions/checkout@v4</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Fazer upload de logs</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">uses</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> actions/upload</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">artifact@v4</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">with</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> todos</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">logs       </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># nome do artefato</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">path</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token plain\">                   </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># caminho dos arquivos inclu√≠dos no artefato</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token important\">**/log*.txt</span><span class=\"token plain\">             </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># caminhos relativos t√™m como base o $GITHUB_WORKSPACE</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">retention-days</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">1</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">if-no-files-found</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> error  </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># for√ßar etapa a falhar se o conte√∫do a ser inclu√≠do no artefato n√£o for encontrado</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Observe que o per√≠odo m√°ximo de reten√ß√£o <a href=\"https://docs.github.com/en/actions/learn-github-actions/usage-limits-billing-and-administration#artifact-and-log-retention-policy\" target=\"_blank\" rel=\"noopener noreferrer\">pode ser definido em n√≠vel de reposit√≥rio, organiza√ß√£o ou empresa</a>. H√° um m√°ximo de 90 dias para reposit√≥rios p√∫blicos e de 400 dias para reposit√≥rios privados. Se voc√™ diminuir o per√≠odo de reten√ß√£o, ter√° mais espa√ßo de gra√ßa ;)</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"baixar-artefatos\">Baixar artefatos<a href=\"https://magmanu.github.io/blog/pt-BR/tech/github-actions-data-flow#baixar-artefatos\" class=\"hash-link\" aria-label=\"Link direto para Baixar artefatos\" title=\"Link direto para Baixar artefatos\">‚Äã</a></h3>\n<p>Para recuperar o artefato, voc√™ pode usar:</p>\n<ul>\n<li>a <a href=\"https://docs.github.com/en/actions/managing-workflow-runs/downloading-workflow-artifacts\" target=\"_blank\" rel=\"noopener noreferrer\">UI do GitHub</a></li>\n<li>a <a href=\"https://docs.github.com/en/rest/actions/artifacts?apiVersion=2022-11-28#download-an-artifact\" target=\"_blank\" rel=\"noopener noreferrer\">API do GitHub</a></li>\n<li>o <a href=\"https://docs.github.com/en/actions/managing-workflow-runs/downloading-workflow-artifacts?tool=cli\" target=\"_blank\" rel=\"noopener noreferrer\"><code>gh</code> cli</a></li>\n<li>a a√ß√£o oficial <a href=\"https://github.com/marketplace/actions/download-a-build-artifact\" target=\"_blank\" rel=\"noopener noreferrer\"><code>actions/download-artifact</code></a>, se precisar recuperar artefatos de maneira program√°tica. A partir da <code>v4</code>, a a√ß√£o permite baixar artefatos de diferentes fluxos de trabalho ou reposit√≥rios, desde que voc√™ forne√ßa um token. (üõ°Ô∏è: √© recomendado usar um aplicativo GitHub em vez de um PAT em projetos profissionais.)</li>\n</ul>\n<p>Vamos ver como recuperar o artefato que criamos no exemplo anterior usando <code>actions/download-artifact</code>:</p>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">/.github/workflows/handle-artefacts.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token key atrule\" style=\"color:#00a4db\">download</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">needs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> upload</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Baixar artefatos</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">id</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> baixar</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">artefatos</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">uses</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> actions/download</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">artifact@v4</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">with</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> todos</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">logs  </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># √© o nome definido na etapa de upload</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Usar o artefato em um c√≥digo python</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">shell</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> python</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          import os</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          from glob import glob</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          caminho_artefato = os.environ.get(\"CAMINHO\", \"\")</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          glob_list = glob(caminho_artefato + \"/*.txt\")</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          for nome_arquivo in glob_list:</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">              with open(nome_arquivo, \"r\", encoding=\"UTF-8\") as f:</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">                  conteudo = f.read()</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">                  print(conteudo)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">env</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">CAMINHO</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> steps.baixar</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">artefatos.outputs.download</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">path </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>As a√ß√µes de upload e download gerenciam o zip e o unzip dos artefatos automaticamente.</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"apagar-artefatos\">Apagar artefatos<a href=\"https://magmanu.github.io/blog/pt-BR/tech/github-actions-data-flow#apagar-artefatos\" class=\"hash-link\" aria-label=\"Link direto para Apagar artefatos\" title=\"Link direto para Apagar artefatos\">‚Äã</a></h3>\n<p>Para excluir um artefato, voc√™ pode:</p>\n<ul>\n<li>usar a <a href=\"https://docs.github.com/en/actions/managing-workflow-runs/removing-workflow-artifacts\" target=\"_blank\" rel=\"noopener noreferrer\">UI do GitHub</a></li>\n<li>usar a <a href=\"https://docs.github.com/en/rest/reference/actions#delete-an-artifact\" target=\"_blank\" rel=\"noopener noreferrer\">API do GitHub</a></li>\n<li>escrever um <a href=\"https://gist.github.com/qwe321qwe321qwe321/efae4569576006624c34f23b2dd76a58\" target=\"_blank\" rel=\"noopener noreferrer\">script personalizado usando a API do Github</a> ou usar uma <a href=\"https://github.com/GeekyEggo/delete-artifact\" target=\"_blank\" rel=\"noopener noreferrer\">a√ß√£o criada pela comunidade</a>.</li>\n</ul>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"como-usar-cache\">Como usar cache<a href=\"https://magmanu.github.io/blog/pt-BR/tech/github-actions-data-flow#como-usar-cache\" class=\"hash-link\" aria-label=\"Link direto para Como usar cache\" title=\"Link direto para Como usar cache\">‚Äã</a></h2>\n<div class=\"theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger\"><div class=\"admonitionHeading_Gvgb\"><span class=\"admonitionIcon_Rf37\"><svg viewBox=\"0 0 12 16\"><path fill-rule=\"evenodd\" d=\"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z\"></path></svg></span>üêâ Aviso de seguran√ßa</div><div class=\"admonitionContent_BuS1\"><p>N√£o armazene informa√ß√µes confidenciais no cache (cuidado com arquivos de configura√ß√£o contendo senhas!), pois o cache √© acess√≠vel a qualquer pessoa com direito de criar um PR no reposit√≥rio - isso inclui forks!</p></div></div>\n<p>Este post j√° est√° grande demais. Vou tentar ser mais objetiva ao explicar cache:</p>\n<ul>\n<li>\n<p>Se voc√™ estiver usando executores auto-hospedados (self-hosted runners), a op√ß√£o de armazenar o cache na sua pr√≥pria infra s√≥ est√° dispon√≠vel nos planos Enterprise.</p>\n</li>\n<li>\n<p>A a√ß√£o de cache requer um <code>path</code> para o cache e uma <code>key</code>. A <code>key</code> √© usada para recuperar o cache e recri√°-lo numa pr√≥xima vez.</p>\n</li>\n<li>\n<p>Quando o trabalho termina, a a√ß√£o injeta automaticamente uma etapa p√≥s-cache que atualiza o cache caso novas depend√™ncias sejam instaladas.</p>\n</li>\n<li>\n<p>Esta a√ß√£o gerencia o cache de forma central. Isso significa que o cache fica dispon√≠vel (e atualiz√°vel) a todos os trabalhos no mesmo reposit√≥rio, e tamb√©m a outros fluxos de trabalho.</p>\n</li>\n<li>\n<p>Leia mais sobre <a href=\"https://github.com/actions/cache/blob/main/caching-strategies.md\" target=\"_blank\" rel=\"noopener noreferrer\">estrat√©gias de cache aqui</a> (em ingl√™s).</p>\n</li>\n</ul>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">/.github/workflows/cache.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token key atrule\" style=\"color:#00a4db\">jobs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">cache</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">uses</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> actions/checkout@v4</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">uses</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> actions/setup</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">python@v5</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">with</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">python-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">'3.12'</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">cache</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">'pip'</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">cache-dependency-path</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">            **/requirements.txt</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Obter diret√≥rio de cache do  pip</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">id</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> pip</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">cache</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"dir=$(pip cache dir)\" &gt;&gt; $GITHUB_OUTPUT</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Controlar cache para depend√™ncias do python</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">uses</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> actions/cache@v3</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">id</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> cache</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">with</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">path</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> steps.pip</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">cache.outputs.dir </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">key</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> runner.os </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">pip</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">$</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> hashFiles('</span><span class=\"token important\">**/requirements.txt')</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Instalar depend√™ncias quando cache n√£o for id√™ntico</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">if</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> steps.cache.outputs.cache</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">hit </span><span class=\"token tag\" style=\"color:#00009f\">!=</span><span class=\"token plain\"> 'true'</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> pip install </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">r requirements.txt</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Se quiser ver a prova do crime, veja os logs salvos (em ingl√™s):</p>\n<ul>\n<li><a href=\"https://raw.githubusercontent.com/magmanu/blog/main/demos/github-actions-data-flow/31_data_flow_cache_set-cache.txt\" target=\"_blank\" rel=\"noopener noreferrer\">logs da defini√ß√£o do cache</a>: primeira execu√ß√£o, n√£o h√° cache, ent√£o o cache √© definido</li>\n<li><a href=\"https://raw.githubusercontent.com/magmanu/blog/main/demos/github-actions-data-flow/32_data_flow_cache_use-cache.txt\" target=\"_blank\" rel=\"noopener noreferrer\">logs do uso do cache</a>: na segunda execu√ß√£o, o cache √© encontrado e usado</li>\n<li><a href=\"https://raw.githubusercontent.com/magmanu/blog/main/demos/github-actions-data-flow/33_data_flow_cache_update-cache.txt\" target=\"_blank\" rel=\"noopener noreferrer\">logs de atualiza√ß√£o do cache</a>: o arquivo requirements.txt foi alterado, ent√£o o cache n√£o coincide. As depend√™ncias s√£o reinstaladas e o cache √© atualizado.</li>\n</ul>\n<p>Curiosidade: voc√™ notou a fun√ß√£o <code>hashFiles</code> usada na etapa acima?<br>\n<!-- -->√â uma fun√ß√£o fornecida pelo GitHub Actions para criar um valor hash exclusivo ligado a um arquivo. Quando o valor do hash n√£o coincide, significa que as depend√™ncias foram alteradas, o que invalida o cache. Assim, as depend√™ncias s√£o instaladas e o cache √© atualizado em uma tarefa p√≥s-cache.</p>\n<p>At√© mais! :)</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"using-cache\">Using cache<a href=\"https://magmanu.github.io/blog/pt-BR/tech/github-actions-data-flow#using-cache\" class=\"hash-link\" aria-label=\"Link direto para Using cache\" title=\"Link direto para Using cache\">‚Äã</a></h2>\n<div class=\"theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger\"><div class=\"admonitionHeading_Gvgb\"><span class=\"admonitionIcon_Rf37\"><svg viewBox=\"0 0 12 16\"><path fill-rule=\"evenodd\" d=\"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z\"></path></svg></span>üêâ Security warning</div><div class=\"admonitionContent_BuS1\"><p>Do not store sensitive information in the cache (beware of configuration files containing secrets), as the cache is accessible to anyone who can create a PR on the repository, even on forks.</p></div></div>\n<p>Quando lidamos com dados est√°veis que s√£o‚Äã‚Äã usados ‚Äã‚Äãrepetidamente (por exemplo, depend√™ncias), podemos usar cache para melhorar o desempenho da pipeline.</p>\n<p>No exemplo abaixo, vamos armazenar em cache as depend√™ncias <code>pip</code>. Repare que a etapa de cache foi colocada antes da etapa de instala√ß√£o das depend√™ncias: a ideia √© que a instala√ß√£o s√≥ aconte√ßa se o cache estiver desatualizado ou inexistente.</p>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">/.github/workflows/cache.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token key atrule\" style=\"color:#00a4db\">jobs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">cache</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">uses</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> actions/checkout@v4</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">uses</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> actions/setup</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">python@v5</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">with</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">python-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">'3.12'</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">cache</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">'pip'</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">cache-dependency-path</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">            **/requirements.txt</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Obter diret√≥rio de cache do  pip</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">id</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> pip</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">cache</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"dir=$(pip cache dir)\" &gt;&gt; $GITHUB_OUTPUT</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Controlar cache para depend√™ncias do python</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">uses</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> actions/cache@v3</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">id</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> cache</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">with</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># path: localiza√ß√£o dos arquivos a serem armazenados em cache</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">path</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> steps.pip</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">cache.outputs.dir </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># key: id √∫nico usado para recuperar e recriar o cache</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">key</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> runner.os </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">pip</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">$</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> hashFiles('</span><span class=\"token important\">**/requirements.txt')</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Instalar depend√™ncias quando cache n√£o for id√™ntico</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">if</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> steps.cache.outputs.cache</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">hit </span><span class=\"token tag\" style=\"color:#00009f\">!=</span><span class=\"token plain\"> 'true'</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> pip install </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">r requirements.txt</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"configurando-o-cache\">Configurando o cache<a href=\"https://magmanu.github.io/blog/pt-BR/tech/github-actions-data-flow#configurando-o-cache\" class=\"hash-link\" aria-label=\"Link direto para Configurando o cache\" title=\"Link direto para Configurando o cache\">‚Äã</a></h3>\n<p>Na primeira vez que o fluxo de trabalho √© executado, obviamente o cache est√° vazio. Por isso, o output <code>cache-hit</code> (nativo da a√ß√£o oficial <code>actions/cache</code>) retornar√° <code>false</code>. Assim, o fluxo de trabalho vai executar a etapa de instala√ß√£o.<br>\n<a href=\"https://raw.githubusercontent.com/magmanu/blog/main/demos/github-actions-data-flow/31_data_flow_cache_set-cache.txt\" target=\"_blank\" rel=\"noopener noreferrer\"><em>Confere nos logs!</em></a> (em ingl√™s)</p>\n<p>Maaaas... Uma pequena m√°gica tamb√©m acontece: uma etapa p√≥s-cache, adicionada automaticamente pela a√ß√£o <code>action/cache</code> no final da execu√ß√£o do trabalho, confere as chaves e adiciona os arquivos ao cache.</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"recuperando-o-cache\">Recuperando o cache<a href=\"https://magmanu.github.io/blog/pt-BR/tech/github-actions-data-flow#recuperando-o-cache\" class=\"hash-link\" aria-label=\"Link direto para Recuperando o cache\" title=\"Link direto para Recuperando o cache\">‚Äã</a></h3>\n<p>Desde que nada tenha mudado no manifesto das depend√™ncias (requirements.txt), quando <code>actions/cache</code> for executado de novo com o mesmo caminho e a mesma chave, a a√ß√£o vai encontrar um <code>cache-hit</code> e o fluxo de trabalho vai pular a etapa de instala√ß√£o.<br>\n<a href=\"https://raw.githubusercontent.com/magmanu/blog/main/demos/github-actions-data-flow/32_data_flow_cache_use-cache.txt\" target=\"_blank\" rel=\"noopener noreferrer\"><em>Confere nos logs!</em></a> (em ingl√™s)</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"atualizando-o-cache\">Atualizando o cache<a href=\"https://magmanu.github.io/blog/pt-BR/tech/github-actions-data-flow#atualizando-o-cache\" class=\"hash-link\" aria-label=\"Link direto para Atualizando o cache\" title=\"Link direto para Atualizando o cache\">‚Äã</a></h3>\n<p>Voc√™ reparou na fun√ß√£o <code>hashFiles</code> usada no argumento <code>key</code>?<br>\n<!-- -->Esta √© uma fun√ß√£o nativa do GitHub Actions que cria uma hash exclusiva baseada no caminho de um arquivo. Quando o valor da hash n√£o d√° match, significa que o arquivo foi alterado ‚Äì no nosso caso, isso pode indicar que alguma depend√™ncia foi adicionada/removida/atualizada.</p>\n<p>Assim, o cache fica in√∫til, e o output <code>cache-hit</code> vai induzir a execu√ß√£o de <code>pip install</code>. Voltamos ent√£o √† √† estaca zero: as depend√™ncias s√£o instaladas mais uma vez e o cache √© atualizado.<br>\n<a href=\"https://raw.githubusercontent.com/magmanu/blog/main/demos/github-actions-data-flow/33_data_flow_cache_update-cache.txt\" target=\"_blank\" rel=\"noopener noreferrer\"><em>Confere nos logs!</em></a> (em ingl√™s)</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"coment√°rios-finais-sobre-caches\">Coment√°rios finais sobre caches<a href=\"https://magmanu.github.io/blog/pt-BR/tech/github-actions-data-flow#coment%C3%A1rios-finais-sobre-caches\" class=\"hash-link\" aria-label=\"Link direto para Coment√°rios finais sobre caches\" title=\"Link direto para Coment√°rios finais sobre caches\">‚Äã</a></h3>\n<ul>\n<li>A op√ß√£o de auto-armazenar o cache em executores auto-hospedados s√≥ est√° dispon√≠vel nos planos Enterprise.</li>\n<li>A a√ß√£o <code>actions/cache</code> gerencia o cache de forma centralizada. Isso significa que o cache fica dispon√≠vel e atualiz√°vel para todos os trabalhos no mesmo repo - e at√© mesmo para outros fluxos de trabalho.</li>\n<li>Leia mais sobre <a href=\"https://github.com/actions/cache/blob/main/caching-strategies.md\" target=\"_blank\" rel=\"noopener noreferrer\">estrat√©gias de cache aqui</a> (em ingl√™s).</li>\n</ul>\n<p>Eita que post grande, socorro.</p>",
            "url": "https://magmanu.github.io/blog/pt-BR/tech/github-actions-data-flow",
            "title": "GitHub Actions: Fluxo e Persist√™ncia de Dados em Workflows",
            "summary": "Quando se trata de Github Actions, os dados n√£o s√£o persistentes por natureza, nem ficam dispon√≠veis para todo o pipeline. Cada etapa (step) tem seu pr√≥prio processo, cada trabalho (job) tem seu pr√≥prio executor (runner). Por padr√£o, quaisquer dados que surjam em um trabalho terminam com ele.",
            "date_modified": "2023-10-31T00:00:00.000Z",
            "author": {
                "name": "Manu Magalh√£es",
                "url": "https://github.com/magmanu"
            },
            "tags": [
                "github actions",
                "ci/cd",
                "pipeline",
                "env",
                "outputs",
                "artefatos",
                "cache"
            ]
        },
        {
            "id": "https://magmanu.github.io/blog/pt-BR/tech/dynamic-json-in-terraform",
            "content_html": "<p>Quem programa n√£o se aguenta, n√©? N√£o pode ver uma coisinha declarativa que j√° quer fazer um loop, colocar uma l√≥gica, faz qualquer coisa menos... declara√ß√£o.</p>\n<p>Aqui vou mostrar como gerar um JSON din√¢mico no Terraform. Neste artigo vou usar Step Functions como exemplo, mas voc√™ pode usar o JSON que quiser.</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"o-que-vamos-fazer\">O que vamos fazer<a href=\"https://magmanu.github.io/blog/pt-BR/tech/dynamic-json-in-terraform#o-que-vamos-fazer\" class=\"hash-link\" aria-label=\"Link direto para O que vamos fazer\" title=\"Link direto para O que vamos fazer\">‚Äã</a></h2>\n<p>O JSON abaixo vai sofrer uma transforma√ß√£o. Vamos substituir os valores est√°ticos por:</p>\n<ol>\n<li><a href=\"https://magmanu.github.io/blog/pt-BR/tech/dynamic-json-in-terraform#caso-1-injetando-uma-vari%C3%A1vel-no-json\">Uma vari√°vel</a></li>\n<li><a href=\"https://magmanu.github.io/blog/pt-BR/tech/dynamic-json-in-terraform#caso-2-injetando-uma-lista-no-json\">Uma lista din√¢mica</a></li>\n<li><a href=\"https://magmanu.github.io/blog/pt-BR/tech/dynamic-json-in-terraform#caso-3-injetando-um-objeto-no-json\">Um ou mais objetos din√¢micos</a></li>\n</ol>\n<p>(Adicionei coment√°rios n√£o idiom√°ticos dentro do c√≥digo, mas √© s√≥ para deixar bem claro o que estamos fazendo.)</p>\n<div class=\"language-json codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">JSON de refer√™ncia</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-json codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Comment\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"My state machine\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"StartAt\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Choice\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"States\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Handle Notification\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::lambda:invoke\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"OutputPath\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.Payload\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token property\" style=\"color:#36acaa\">\"Payload.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              ----&gt; Caso </span><span class=\"token number\" style=\"color:#36acaa\">1</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Substituir a string expl√≠cita por uma string din√¢mica</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token property\" style=\"color:#36acaa\">\"FunctionName\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"my_function_name\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"End\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Choice\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Choice\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          ----&gt; Caso </span><span class=\"token number\" style=\"color:#36acaa\">2</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Substituir por uma lista din√¢mica</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"Choices\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">                          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">             </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">                                           </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">               </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                        </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">               </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM Execution-InstanceId\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">       </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">               </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.InstanceId\"</span><span class=\"token plain\">                </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                                         </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">                                          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">               </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                        </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">               </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM Execution-SecurityGroupIds\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">               </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.SecurityGroupIds\"</span><span class=\"token plain\">          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">                                          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                                   </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Default\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        ----&gt; Caso </span><span class=\"token number\" style=\"color:#36acaa\">3</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Substituir por um ou mais objetos din√¢micos</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"SSM Execution-InstanceId\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">        </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">                          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token property\" style=\"color:#36acaa\">\"DocumentName.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.DocumentName\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">  </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">                      </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token property\" style=\"color:#36acaa\">\"InstanceId.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.InstanceId)\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">                                    </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                                     </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::aws-sdk:ssm:startAutomationExecution\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"ResultPath\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.TaskResult\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">            </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token plain\">                           </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                                           </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"SSM Execution-SecurityGroupIds\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">                          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token property\" style=\"color:#36acaa\">\"DocumentName.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.DocumentName\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">  </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">                      </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token property\" style=\"color:#36acaa\">\"SecurityGroupIds.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.SecurityGroupIds)\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">                                    </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                                       </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::aws-sdk:ssm:startAutomationExecution\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"ResultPath\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.TaskResult\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">            </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token plain\">                           </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                                   </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Pass\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"End\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Primeiro, salve o JSON acima em formato de template. Voc√™ pode usar a extens√£o <code>.tpl</code> ou <code>.tftpl</code>. Embora o Terraform recomende usar a segunda op√ß√£o, n√£o existe uma regra r√≠gida sobre qual extens√£o usar.</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"caso-1-injetando-uma-vari√°vel-no-json\">Caso 1: Injetando uma vari√°vel no JSON<a href=\"https://magmanu.github.io/blog/pt-BR/tech/dynamic-json-in-terraform#caso-1-injetando-uma-vari%C3%A1vel-no-json\" class=\"hash-link\" aria-label=\"Link direto para Caso 1: Injetando uma vari√°vel no JSON\" title=\"Link direto para Caso 1: Injetando uma vari√°vel no JSON\">‚Äã</a></h2>\n<p>Vamos come√ßar atualizando o valor <code>FunctionName</code> no template, usando interpola√ß√£o:</p>\n<div class=\"language-json codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/templates/stepfunction_definition.tftpl (parcial)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-json codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"Handle Notification\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::lambda:invoke\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"OutputPath\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.Payload\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"Payload.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"FunctionName\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"${nome_da_lambda}\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"End\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>O template precisa ser renderizado como um JSON v√°lido, ent√£o vamos usar a fun√ß√£o <code>templatefile</code> do Terraform. Pra isso, usamos dois argumentos: o caminho (path) do template e um mapa de vari√°veis a serem injetadas na runtime (execu√ß√£o). Vou tentar manter o m√≥dulo o mais din√¢mico poss√≠vel, e vou incluir locals, vari√°veis e resources (recursos) do Terraform para mostrar como as coisas funcionam juntas.</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/stepfunction.tf (full file)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">locals</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">file</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> templatefile(</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation keyword\" style=\"color:#00009f\">path</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation type variable\" style=\"color:#36acaa\">module</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">/templates/stepfunction_definition.tpl\"</span><span class=\"token plain\">, </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">nome_da_lambda</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.nome_da_lambda</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">variable</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"nome_da_lambda\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">description</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Nome da lambda\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">type</span><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> string</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">resource </span><span class=\"token keyword type variable\" style=\"color:#36acaa\">\"aws_sfn_state_machine\"</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"sfn_state_machine\"</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">name</span><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.nome_da_step_function</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">role_arn</span><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.sf_role_arn</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">definition</span><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> local.file</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Agora vamos salvar um <code>main.tf</code> um n√≠vel acima, onde os valores expl√≠citos (hardcoded) ser√£o definidos.</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">main.tf (full file)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># main.tf (arquivo completo)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">module</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"minha_step_function\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token property\" style=\"color:#36acaa\">source</span><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"./modules/step_functions\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token property\" style=\"color:#36acaa\">nome_da_step_function</span><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"autoremedia√ß√£o\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token property\" style=\"color:#36acaa\">sf_role_arn</span><span class=\"token plain\">           </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:iam::123456789012:role/autoremedia√ß√£o\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token property\" style=\"color:#36acaa\">nome_da_lambda</span><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"lambda_de_autoremedia√ß√£o\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Se quiser conferir que a vari√°vel foi injetada com sucesso, execute <code>terraform init &amp;&amp; terraform plan</code> no terminal.</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"caso-2-injetando-uma-lista-no-json\">Caso 2: Injetando uma lista no JSON<a href=\"https://magmanu.github.io/blog/pt-BR/tech/dynamic-json-in-terraform#caso-2-injetando-uma-lista-no-json\" class=\"hash-link\" aria-label=\"Link direto para Caso 2: Injetando uma lista no JSON\" title=\"Link direto para Caso 2: Injetando uma lista no JSON\">‚Äã</a></h2>\n<p>S√≥ pra lembrar, esta √© a lista que estamos refatorando:</p>\n<div class=\"language-json codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/templates/stepfunction_definition.tftpl (parcial)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-json codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token property\" style=\"color:#36acaa\">\"Choice\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Choice\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Choices\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">                            </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">                                           </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                        </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM Execution-InstanceId\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">       </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.InstanceId\"</span><span class=\"token plain\">                </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                                          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">                                           </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                        </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM Execution-SecurityGroupIds\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.SecurityGroupIds\"</span><span class=\"token plain\">          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">                                           </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                                      </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Default\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Vamos refatorar o template de novo. Vamos usar uma fun√ß√£o do Terraform chamada <code>jsonencode</code>, que faz a lista de objetos usada no template ser renderizada como JSON:</p>\n<div class=\"language-json codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/templates/stepfunction_definition.tftpl (parcial)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-json codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token property\" style=\"color:#36acaa\">\"Choice\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Choice\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Choices\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">jsonencode(lista_de_op√ß√µes)</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Default\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Agora, vamos ver duas maneiras de passar a lista para o template.</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"a-solu√ß√£o-mais-simples-lista-expl√≠cita\">A solu√ß√£o mais simples: lista expl√≠cita<a href=\"https://magmanu.github.io/blog/pt-BR/tech/dynamic-json-in-terraform#a-solu%C3%A7%C3%A3o-mais-simples-lista-expl%C3%ADcita\" class=\"hash-link\" aria-label=\"Link direto para A solu√ß√£o mais simples: lista expl√≠cita\" title=\"Link direto para A solu√ß√£o mais simples: lista expl√≠cita\">‚Äã</a></h3>\n<p>Uma op√ß√£o √© criar uma vari√°vel que vai passar uma lista pronta:</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/stepfunction.tf (pacial)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">locals</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">file</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> templatefile(</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation keyword\" style=\"color:#00009f\">path</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation type variable\" style=\"color:#36acaa\">module</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">/templates/stepfunction_definition.tpl\"</span><span class=\"token plain\">, </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">nome_da_lambda</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.nome_da_lambda</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        lista_de_op√ß√µ</span><span class=\"token property\" style=\"color:#36acaa\">es</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.minha_lista</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">variable</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"minha_lista\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">description</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"A lista que voc√™ quiser\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">type</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> list</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Agora, no m√≥dulo <code>main.tf</code>, passe os valores das vari√°veis. O JSON ficou √© din√¢mico, mas a lista √© ainda √© meio ‚Äúest√°tica‚Äù porque foi definida explicitamente no m√≥dulo principal. E v√°rias vezes, isso basta.</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">main.tf (full file)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">module</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"minha_step_function\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">source</span><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"./modules/step_functions\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">nome_da_step_function</span><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"autoremedia√ß√£o\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">sf_role_arn</span><span class=\"token plain\">           </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:iam::123456789012:role/autoremedia√ß√£o\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">nome_da_lambda</span><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"lambda_de_autoremedia√ß√£o\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">minha_lista</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token plain\">: </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM Execution-InstanceId\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.InstanceId\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"a-solu√ß√£o-com-muita-l√≥gica-lista-din√¢mica\">A solu√ß√£o com muita l√≥gica: lista din√¢mica<a href=\"https://magmanu.github.io/blog/pt-BR/tech/dynamic-json-in-terraform#a-solu%C3%A7%C3%A3o-com-muita-l%C3%B3gica-lista-din%C3%A2mica\" class=\"hash-link\" aria-label=\"Link direto para A solu√ß√£o com muita l√≥gica: lista din√¢mica\" title=\"Link direto para A solu√ß√£o com muita l√≥gica: lista din√¢mica\">‚Äã</a></h3>\n<p>Mas e se voc√™ quiser que a lista em si tamb√©m seja din√¢mica? Por exemplo, voc√™ quer gerar a lista extraindo os valores de um par√¢metro, e depois enviar a lista para o json?\nEm nosso exemplo, vamos gerar as listas de <code>Next</code> e <code>Variable</code> extraindo as chaves (keys) que est√£o em <code>ssm_params</code>, no arquivo principal <code>main.tf</code>:</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">main.tf (extract)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">module</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"minha_step_function\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">source</span><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"./modules/step_functions\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">nome_da_step_function</span><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"autoremedia√ß√£o\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">sf_role_arn</span><span class=\"token plain\">           </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:iam::123456789012:role/autoremedia√ß√£o\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">nome_da_lambda</span><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"lambda_de_autoremedia√ß√£o\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># Tiramos a lista est√°tica que estava aqui</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">ssm_params</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"InstanceId\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.InstanceId)\"</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,    </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"SecurityGroupIds\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.SecurityGroupIds)\"</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Nosso m√≥dulo vai ficar assim:</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/stepfunction.tf (full file)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">locals</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    lista_de_op√ß√µ</span><span class=\"token property\" style=\"color:#36acaa\">es</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> flatten(</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">for item in var.ssm_params: </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        for chave, valor in item : </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token plain\">: </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM Execution-</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">chave</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">chave</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\">)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">file</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> templatefile(</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation keyword\" style=\"color:#00009f\">path</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation type variable\" style=\"color:#36acaa\">module</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">/templates/stepfunction_definition.tpl\"</span><span class=\"token plain\">, </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">nome_da_lambda</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.nome_da_lambda,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        lista_de_op√ß√µ</span><span class=\"token property\" style=\"color:#36acaa\">es</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> local.lista_de_op√ß√µes</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">variable</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"nome_da_lambda\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">description</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Nome da lambda\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">type</span><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> string</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">variable</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"ssm_params\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">description</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Lista dos par√¢metros de SSM a serem injetados\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">type</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> list</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">resource </span><span class=\"token keyword type variable\" style=\"color:#36acaa\">\"aws_sfn_state_machine\"</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"sfn_state_machine\"</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">name</span><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.nome_da_step_function</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">role_arn</span><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> aws_iam_role.step_function_role_arn</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">definition</span><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> local.file</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Come√ßando com a linha <code>lista_de_op√ß√µes = flatten([for item in var.ssm_params:</code> ignore <code>flatten</code> por um momento e observe o loop.</p>\n<p><code>ssm_params</code> √© uma lista, e vamos ver cada item. O loop est√° entre colchetes, o que significa que o resultado ser√° uma lista. O <code>:</code> que se segue √© apenas parte da sintaxe do loop.</p>\n<p>Na linha a seguir, temos outro loop: <code>for chave, valor in item : {</code> . Este loop passa em cada objeto do <code>ssm_params</code>, acessando a chave e o valor. Assim, podemos extrair e reestruturar os dados. O loop tamb√©m √© colocado entre colchetes, o que significa que, infelizmente, cada objeto estar√° dentro de uma lista pr√≥pria. O resultado final vai ficar assim: <code>[[obj1],[obj2]]</code></p>\n<p>Agora, lembra do <code>flatten</code>? Essa fun√ß√£o do Terraform √© necess√°ria porque precisamos achatar (flatten) esse resultado que est√° cheio de aninhamento (nesting) desnecess√°rio. O flatten faz nosso resultado ficar assim: <code>[obj1, obj2]</code>.</p>\n<p>Pronto.</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"caso-3-injetando-um-objeto-no-json\">Caso 3: Injetando um objeto no JSON<a href=\"https://magmanu.github.io/blog/pt-BR/tech/dynamic-json-in-terraform#caso-3-injetando-um-objeto-no-json\" class=\"hash-link\" aria-label=\"Link direto para Caso 3: Injetando um objeto no JSON\" title=\"Link direto para Caso 3: Injetando um objeto no JSON\">‚Äã</a></h2>\n<p>Agora, a parte mais emocionante. Vamos abstrair objetos inteiros. (Neste caso, significa que etapas inteiras das Step Functions podem ficar din√¢micas!)\nT√° vendo isso tudo a√≠ embaixo? Vai tudo embora!</p>\n<div class=\"language-json codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-json codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token property\" style=\"color:#36acaa\">\"Steps\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"SSM Execution-InstanceId\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">           </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">                          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token property\" style=\"color:#36acaa\">\"DocumentName.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.DocumentName\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">  </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">                      </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token property\" style=\"color:#36acaa\">\"InstanceId.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.InstanceId)\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">                                    </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                                     </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::aws-sdk:ssm:startAutomationExecution\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"ResultPath\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.TaskResult\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">            </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token plain\">                           </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                                           </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"SSM Execution-SecurityGroupIds\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">                          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token property\" style=\"color:#36acaa\">\"DocumentName.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.DocumentName\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">  </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">                      </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token property\" style=\"color:#36acaa\">\"SecurityGroupIds.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.SecurityGroupIds)\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">                                    </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                                       </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::aws-sdk:ssm:startAutomationExecution\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"ResultPath\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.TaskResult\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">            </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token plain\">                           </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">                                   </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Pra variar, vamos modificar o template:</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/templates/stepfunction_definition.tftpl (parcial)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token property\" style=\"color:#36acaa\">\"States\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Choice\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Choice\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token property\" style=\"color:#36acaa\">\"Choices\"</span><span class=\"token plain\">: $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">jsonencode(choices)</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token property\" style=\"color:#36acaa\">\"Default\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    / highlight-start</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    %</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> for chave, data in ssm_execution </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">   </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"${chave}\"</span><span class=\"token plain\">: $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">jsonencode(data)</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    %</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> endfor </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Handle Notification\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">&lt;--- bl√°bl√°--&gt;</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Se seu linter reclamar, mantenha a f√© que t√° tudo certo.</p>\n<p>Mas o que est√° acontecendo? Estamos usando a sintaxe <a href=\"https://developer.hashicorp.com/terraform/language/expressions/strings#directives\" target=\"_blank\" rel=\"noopener noreferrer\">diretiva do Terraform</a> <code>%{}</code> para escrever uma string din√¢mica (pois √©, templates s√£o tratados como strings) .</p>\n<p>A linha <code>%{ for chave, data in ssm_execution }</code> informa √† fun√ß√£o <code>templatefile</code> que uma itera√ß√£o vai come√ßar, e que cs√≥ termina quando chegar na linha <code>%{ endfor }</code>. Enquanto isso, a fun√ß√£o vai ontinuar criando pares de chave-valor com o formato <code>\"minha_chave\": {\"meu\": \"json\"},</code>.</p>\n<p>Legal, n√©?</p>\n<p>Ent√£o agora vamos adicionar o valor local <code>ssm_execution</code>, a l√≥gica que ir√° preencher tudo isso.</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/stepfunction.tf (parcial)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">locals</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">choices</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> flatten(</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">for item in var.ssm_params: </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        for chave, valor in item : </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token plain\">: </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM Execution-</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">chave</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">chave</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\">)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">ssm_execution</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> merge(flatten(</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">for item in var.ssm_params: </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"> </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                    for chave, valor in item : </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                        </span><span class=\"token property\" style=\"color:#36acaa\">\"SSM Execution-${chave}\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                              </span><span class=\"token property\" style=\"color:#36acaa\">\"DocumentName.$\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.DocumentName\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                              </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"$.${chave}\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">valor</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::aws-sdk:ssm:startAutomationExecution\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Handle Notification\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"ResultPath\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.TaskResult\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                )...)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">file</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> templatefile(</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation keyword\" style=\"color:#00009f\">path</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation type variable\" style=\"color:#36acaa\">module</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">/templates/stepfunction_definition.tpl\"</span><span class=\"token plain\">, </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">nome_da_lambda</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.nome_da_lambda,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        lista_de_op√ß√µ</span><span class=\"token property\" style=\"color:#36acaa\">es</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> local.choices,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">ssm_execution</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> local.ssm_execution</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>J√° estamos familiarizados com loops e flatten, ent√£o vamos falar sobre as novidades: <code>merge</code> e <code>...</code>.</p>\n<p><code>merge</code> √© uma fun√ß√£o do Terraform que junta v√°rios objetos em um s√≥. Ent√£o, se tivermos dois objetos assim:</p>\n<div class=\"language-json codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-json codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">   </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">     </span><span class=\"token property\" style=\"color:#36acaa\">\"a\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">1</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">     </span><span class=\"token property\" style=\"color:#36acaa\">\"b\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">2</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">   </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">   </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">     </span><span class=\"token property\" style=\"color:#36acaa\">\"c\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">3</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">     </span><span class=\"token property\" style=\"color:#36acaa\">\"d\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">4</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">   </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>a fun√ß√£o <code>merge</code> vai transform√°-los em:</p>\n<div class=\"language-json codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-json codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">     </span><span class=\"token property\" style=\"color:#36acaa\">\"a\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">1</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">     </span><span class=\"token property\" style=\"color:#36acaa\">\"b\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">2</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">     </span><span class=\"token property\" style=\"color:#36acaa\">\"c\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">3</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">     </span><span class=\"token property\" style=\"color:#36acaa\">\"d\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">4</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>E se voc√™ estava prestando aten√ß√£o, notou que a fun√ß√£o merge em nosso m√≥dulo <strong>n√£o</strong> est√° usando objetos como argumento, ela est√° usando a fun√ß√£o flatten (que gera uma √∫nica lista). O truque est√° aqui: <code>...</code>.</p>\n<p>No Terraform, <code>...</code> (tr√™s pontos) funciona como o operador spread em Javascript: ele expande a lista em argumentos separados, individuais.</p>\n<p>Ent√£o √© isso. Nosso template final ficou literalmente com metade do tamanho do JSON original. Ele √© din√¢mico, reutiliz√°vel e o melhor de tudo ‚Äì voc√™ nunca mais vai precisar o Amazon States Language no seu projeto. Vale cada minuto investido.</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"arquivos-finais\">Arquivos Finais<a href=\"https://magmanu.github.io/blog/pt-BR/tech/dynamic-json-in-terraform#arquivos-finais\" class=\"hash-link\" aria-label=\"Link direto para Arquivos Finais\" title=\"Link direto para Arquivos Finais\">‚Äã</a></h2>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/templates/stepfunction_definition.tpl</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Comment\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"My state machine\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"StartAt\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Choice\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"States\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Handle Notification\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::lambda:invoke\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"OutputPath\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.Payload\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token property\" style=\"color:#36acaa\">\"Payload.$\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token property\" style=\"color:#36acaa\">\"FunctionName\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">nome_da_lambda</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"End\"</span><span class=\"token plain\">: </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Choice\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Choice\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Choices\"</span><span class=\"token plain\">: $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">jsonencode(choices)</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Default\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        %</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> for chave, data in ssm_execution </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"${chave}\"</span><span class=\"token plain\">: $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">jsonencode(data)</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        %</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> endfor </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Pass\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"End\"</span><span class=\"token plain\">: </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/stepfunction.tf</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token keyword\" style=\"color:#00009f\">locals</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">choices</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> flatten(</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">for item in var.ssm_params: </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        for chave, valor in item : </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token plain\">: </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM Execution-</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">chave</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">chave</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\">)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">ssm_execution</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> merge(flatten(</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">for item in var.ssm_params: </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"> </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                    for chave, valor in item : </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                        </span><span class=\"token property\" style=\"color:#36acaa\">\"SSM Execution-${chave}\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                              </span><span class=\"token property\" style=\"color:#36acaa\">\"DocumentName.$\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.DocumentName\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                              </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"$.${chave}\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">valor</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::aws-sdk:ssm:startAutomationExecution\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Handle Notification\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"ResultPath\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.TaskResult\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                )...)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">file</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> templatefile(</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation keyword\" style=\"color:#00009f\">path</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation type variable\" style=\"color:#36acaa\">module</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">/templates/stepfunction_definition.tpl\"</span><span class=\"token plain\">, </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">nome_da_lambda</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.nome_da_lambda,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        lista_de_op√ß√µ</span><span class=\"token property\" style=\"color:#36acaa\">es</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> local.choices,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">ssm_execution</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> local.ssm_execution</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">variable</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"nome_da_lambda\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">description</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Nome da lambda\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">type</span><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> string</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">variable</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"ssm_params\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">description</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Lista dos par√¢metros de SSM a serem injetados\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">type</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> list</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">resource </span><span class=\"token keyword type variable\" style=\"color:#36acaa\">\"aws_sfn_state_machine\"</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"sfn_state_machine\"</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">name</span><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.nome_da_step_function</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">role_arn</span><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.sf_role_arn</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">definition</span><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> local.file</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">main.tf</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># main.tf (arquivo completo)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">module</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"minha_step_function\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">source</span><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"./modules/step_functions\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">nome_da_step_function</span><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"autoremedia√ß√£o\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">sf_role_arn</span><span class=\"token plain\">           </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:iam::123456789012:role/autoremedia√ß√£o\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">nome_da_lambda</span><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"lambda_de_autoremedia√ß√£o\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">ssm_params</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">                </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"InstanceId\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.InstanceId)\"</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,    </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"SecurityGroupIds\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.SecurityGroupIds)\"</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>",
            "url": "https://magmanu.github.io/blog/pt-BR/tech/dynamic-json-in-terraform",
            "title": "Como Gerar JSON Din√¢mico no Terraform",
            "summary": "Quem programa n√£o se aguenta, n√©? N√£o pode ver uma coisinha declarativa que j√° quer fazer um loop, colocar uma l√≥gica, faz qualquer coisa menos... declara√ß√£o.",
            "date_modified": "2023-03-18T00:00:00.000Z",
            "author": {
                "name": "Manu Magalh√£es",
                "url": "https://github.com/magmanu"
            },
            "tags": [
                "infra",
                "terraform",
                "IaC",
                "step functions",
                "devops"
            ]
        },
        {
            "id": "https://magmanu.github.io/blog/pt-BR/tech/terraform-ternary-error",
            "content_html": "<p>Voc√™ j√° encontrou esse erro no Terraform, quando o que voc√™ queria era exatamente ter tipos diferentes no resultado do tern√°rio?</p>\n<blockquote>\n<p>The true and false result expressions must have consistent types<br>\n<em>Express√µes com resultado true ou false devem ter tipos consistentes</em></p>\n</blockquote>\n<p>Vou dar dois exemplos de como contornar esse problema, mas a regra geral √© esta aqui:</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token property\" style=\"color:#36acaa\">atributo</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    &lt;valor caso </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\">&gt;, </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    &lt;valor caso </span><span class=\"token boolean\" style=\"color:#36acaa\">false</span><span class=\"token plain\">&gt;</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">&lt;condicional&gt; ? </span><span class=\"token number\" style=\"color:#36acaa\">0</span><span class=\"token plain\"> : </span><span class=\"token number\" style=\"color:#36acaa\">1</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"exemplo-simples\">Exemplo simples<a href=\"https://magmanu.github.io/blog/pt-BR/tech/terraform-ternary-error#exemplo-simples\" class=\"hash-link\" aria-label=\"Link direto para Exemplo simples\" title=\"Link direto para Exemplo simples\">‚Äã</a></h2>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token keyword\" style=\"color:#00009f\">locals</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">valor_dinamico</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"regiao\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation keyword\" style=\"color:#00009f\">var</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation type variable\" style=\"color:#36acaa\">regiao</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">, </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token string\" style=\"color:#e3116c\">\"indispon√≠vel\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">var.regiao </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"eu-west-1\"</span><span class=\"token plain\"> ? </span><span class=\"token number\" style=\"color:#36acaa\">0</span><span class=\"token plain\"> : </span><span class=\"token number\" style=\"color:#36acaa\">1</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>No exemplo acima, <code>local.valor_dinamico</code> vai ser avaliado como <code>{\"regiao: \"eu-west-1\"}</code>, que √© um <code>objeto</code>, se a regi√£o da AWS for a Irlanda; e retorna <code>\"indispon√≠vel\"</code>, que √© uma <code>string</code>, se for alguma outra regi√£o.</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"pera-como-√©-que-√©\">Pera, como √© que √©?<a href=\"https://magmanu.github.io/blog/pt-BR/tech/terraform-ternary-error#pera-como-%C3%A9-que-%C3%A9\" class=\"hash-link\" aria-label=\"Link direto para Pera, como √© que √©?\" title=\"Link direto para Pera, como √© que √©?\">‚Äã</a></h3>\n<p>Em vez de usar o tern√°rio da maneira tradicional, n√≥s usamos uma tupla (tamb√©m conhecida como lista com tipos mistos) e aproveitamos a estrutura do tern√°rio para avaliar qual √≠ndice cont√©m o valor de que precisamos.</p>\n<p>No fundo, estamos selecionando se queremos o primeiro ou segundo valor que est√° na tupla, como se fosse  <code>tupla[0]</code> ou <code>tupla[1]</code>.</p>\n<p>Obrigada Mariux pelo truque.</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"um-exemplo-menos-simples\">Um exemplo menos simples<a href=\"https://magmanu.github.io/blog/pt-BR/tech/terraform-ternary-error#um-exemplo-menos-simples\" class=\"hash-link\" aria-label=\"Link direto para Um exemplo menos simples\" title=\"Link direto para Um exemplo menos simples\">‚Äã</a></h2>\n<p>Tamb√©m d√° pra fazer coisas mais complexas e din√¢micas. N√£o estou dizendo fica bonito ou que seja recomend√°vel, mas √†s vezes a gente faz o que tem que ser feito.</p>\n<p>No meu caso, a l√≥gica tern√°ria que eu precisava era usada em uma Step Function. Eu tinha um objeto, e se esse objeto tivesse s√≥ uma chave (key), eu precisava de um JSON. Se o objeto tivesse mais do que uma chave, eu precisava de um JSON diferente.</p>\n<p>A coisa fica meio feia porque tem l√≥gica em tudo quanto √© lugar, mas aqui vai o resultado:</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token keyword\" style=\"color:#00009f\">variable</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"ssm_params\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">description</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Par√¢metro exigido pelo SSM Documents para ativar rota√ß√£o de chaves KMS\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">default</span><span class=\"token plain\">     </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"KeyId\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.KeyId)\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token property\" style=\"color:#36acaa\">\"AutomationAssumeRole\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.AutomationAssumeRole)\"</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">locals</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token property\" style=\"color:#36acaa\">choices</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">for item in var.ssm_params: </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># valor caso true </span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    merge(flatten(</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      for key, value in item: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token plain\">: </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM-</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">key</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">key</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\">)...), </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\">#&nbsp;valor caso false</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    merge(</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> </span><span class=\"token property\" style=\"color:#36acaa\">\"And\"</span><span class=\"token plain\"> : </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          for key, value in item: </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token plain\">: </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">key</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM-</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation function\" style=\"color:#d73a49\">join</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">(</span><span class=\"token string interpolation string\" style=\"color:#e3116c\">\"\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">,</span><span class=\"token string interpolation\" style=\"color:#e3116c\"> </span><span class=\"token string interpolation function\" style=\"color:#d73a49\">sort</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">(</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">[</span><span class=\"token string interpolation function\" style=\"color:#d73a49\">keys</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">(</span><span class=\"token string interpolation\" style=\"color:#e3116c\">item</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">)</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">]</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">)</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">)</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\">...)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># condicional</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      length(flatten(</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">keys(item)</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\">)) </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">1</span><span class=\"token plain\"> ? </span><span class=\"token number\" style=\"color:#36acaa\">0</span><span class=\"token plain\"> : </span><span class=\"token number\" style=\"color:#36acaa\">1</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Minha tupla tem dois valores, os dois come√ßam com <code>merge</code> e resultam em um array de objetos com valores gerados dinamicamente. E como d√° pra ver, a estrutura dos objetos √© diferente em cada caso, e √© por isso que a solu√ß√£o padr√£o para tern√°rios n√£o funciona.</p>\n<p>A seguir, a parte do condicional tamb√©m √© din√¢mica. A gente extrai as chaves do objeto, coloca as chaves em um √∫nico array usando <code>flatten</code> e avalia o tamanho do array. Se s√≥ houver um elemento, o resultado final ser√° o primeiro valor da tupla. Caso contr√°rio, o resultado final ser√° o segundo valor da tupla.</p>\n<p>N√£o me pergunte como eu n√£o joguei o computador pela janela, mas funcionou. S√≥ que eu nunca mais quero fazer uma coisa dessas. Se uma linguagem √© declarativa n√£o era pra ter l√≥gica complexa, n√©. Enfim. <!-- -->:P</p>",
            "url": "https://magmanu.github.io/blog/pt-BR/tech/terraform-ternary-error",
            "title": "Solu√ß√£o: Terraform n√£o deixa tern√°rios terem tipos diferentes",
            "summary": "Voc√™ j√° encontrou esse erro no Terraform, quando o que voc√™ queria era exatamente ter tipos diferentes no resultado do tern√°rio?",
            "date_modified": "2023-03-18T00:00:00.000Z",
            "author": {
                "name": "Manu Magalh√£es",
                "url": "https://github.com/magmanu"
            },
            "tags": [
                "infra",
                "terraform",
                "gambiarra",
                "devops"
            ]
        },
        {
            "id": "https://magmanu.github.io/blog/pt-BR/tech/migrate-codecommit-to-github",
            "content_html": "<p>Este tutorial inclui orienta√ß√µes para tr√™s cen√°rios de administra√ß√£o no GitHub:</p>\n<ol>\n<li>Quando o repo est√° na sua conta pessoal;</li>\n<li>Quando o repo est√° dentro de uma organiza√ß√£o no GitHub e a galera da administra√ß√£o te d√° as permiss√µes necess√°rias; e</li>\n<li>Quando o repo est√° dentro de uma organiza√ß√£o no GitHub e a galera da administra√ß√£o N√ÉO te d√° as permiss√µes necess√°rias.</li>\n</ol>\n<p><em>Pr√©-requisitos: Acesso e permiss√µes relevantes para CodeCommit e Amplify. Voc√™ tamb√©m precisa de uma conta ativa no GitHub.</em></p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"migrando-o-repo\">Migrando o Repo<a href=\"https://magmanu.github.io/blog/pt-BR/tech/migrate-codecommit-to-github#migrando-o-repo\" class=\"hash-link\" aria-label=\"Link direto para Migrando o Repo\" title=\"Link direto para Migrando o Repo\">‚Äã</a></h2>\n<ol>\n<li>Abra o terminal e fa√ßa cd para a pasta onde est√° o repo do CodeCommit.</li>\n<li>Execute <code>git remote get-url origin</code> para obter o URL para clonar o projeto a ser migrado para o GitHub.</li>\n<li>Crie uma pasta tempor√°ria executando <code>mkdir ../temp-clone</code> e abra-a na CLI executando <code>cd ../temp-clone</code>.</li>\n<li>Execute <code>git clone --bare</code> seguido do URL que voc√™ pegou na etapa 2. Um exemplo seria <code>git clone --bare &lt;https://git-codecommit.eu-west-1.amazonaws.com/v1/repos/nome-do-diretorio-do-codecommit&gt;</code>.</li>\n</ol>\n<br>\n<div class=\"theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary\"><div class=\"admonitionHeading_Gvgb\"><span class=\"admonitionIcon_Rf37\"><svg viewBox=\"0 0 14 16\"><path fill-rule=\"evenodd\" d=\"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z\"></path></svg></span>Nota Educativa</div><div class=\"admonitionContent_BuS1\"><p>O sufixo (flag) <code>--bare</code> √© uma forma de clonar o repo cortando todos os v√≠nculos com o remoto (CodeCommit, neste caso). Voc√™ ainda vai ter todos os branches, tags e tal, mas o repo clonado fica completamente independente do remoto.</p></div></div>\n<br>\n<ol start=\"5\">\n<li>Crie um novo repo no GitHub. Para evitar problemas, n√£o adicione nenhum README, .gitignore nem nada. Depois de clicar em ‚ÄúCreate repo‚Äù (Criar repo), a √∫nica coisa a fazer √© copiar o URL como mostrado abaixo. N√£o execute nenhum git init, n√£o fa√ßa um commit inicial, nada. S√≥ copia o link.</li>\n</ol>\n<br>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Git clone SSH\" src=\"https://magmanu.github.io/blog/pt-BR/assets/images/clone_ssh-5be730cf4d2ec7e3548855fc55af9e16.webp\" width=\"1400\" height=\"508\" class=\"img_ev3q\"></p>\n<br>\n<ol start=\"6\">\n<li>Voltando ao terminal, execute <code>cd nome-do-diretorio-do-codecommit.git</code>, e depois fa√ßa um push mirror seguido pelo URL que voc√™ obteve na etapa 5. No exemplo acima, o comando seria <code>git push --mirror &lt;https://github.com/my-username/my-project.git&gt;</code>.</li>\n</ol>\n<p>√â isso, a migra√ß√£o acabou.</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"confirme\">Confirme<a href=\"https://magmanu.github.io/blog/pt-BR/tech/migrate-codecommit-to-github#confirme\" class=\"hash-link\" aria-label=\"Link direto para Confirme\" title=\"Link direto para Confirme\">‚Äã</a></h3>\n<p>Para confirmar que deu tudo certo, volte ao GitHub e atualize a p√°gina. O repo vai estar todo bonitinho l√°, com hist√≥rico de commits, as branches e o resto todo.<br>\n<!-- -->Para usar repo migrado para o GitHub, √© s√≥ fazer o clone de sempre e seguir com a vida :)</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"arrume\">Arrume<a href=\"https://magmanu.github.io/blog/pt-BR/tech/migrate-codecommit-to-github#arrume\" class=\"hash-link\" aria-label=\"Link direto para Arrume\" title=\"Link direto para Arrume\">‚Äã</a></h3>\n<p>Se voc√™ seguiu as instru√ß√µes, agora √© hora de excluir sua pasta tempor√°ria. Volte para o terminal e execute <code>cd ../..</code> e <code>rm -rf temp-clone</code>. Se voc√™ usou a pasta tmp do sistema operacional, pode pular essa etapa.</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"redirecionando-a-pipeline-do-amplify\">Redirecionando a pipeline do Amplify<a href=\"https://magmanu.github.io/blog/pt-BR/tech/migrate-codecommit-to-github#redirecionando-a-pipeline-do-amplify\" class=\"hash-link\" aria-label=\"Link direto para Redirecionando a pipeline do Amplify\" title=\"Link direto para Redirecionando a pipeline do Amplify\">‚Äã</a></h2>\n<p>Agora que voc√™ migrou o c√≥digo para o GitHub, como voc√™ mant√©m a pipeline Amplify que estava ligada ao repo no CodeCommit?</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"execute-o-comando-update-app\">Execute o comando <code>update-app</code><a href=\"https://magmanu.github.io/blog/pt-BR/tech/migrate-codecommit-to-github#execute-o-comando-update-app\" class=\"hash-link\" aria-label=\"Link direto para execute-o-comando-update-app\" title=\"Link direto para execute-o-comando-update-app\">‚Äã</a></h3>\n<div class=\"language-bash codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-bash codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token assign-left variable\" style=\"color:#36acaa\">AWS_PROFILE</span><span class=\"token operator\" style=\"color:#393A34\">=</span><span class=\"token plain\">PERFIL </span><span class=\"token assign-left variable\" style=\"color:#36acaa\">AWS_DEFAULT_REGION</span><span class=\"token operator\" style=\"color:#393A34\">=</span><span class=\"token plain\">REGI√ÉO aws amplify update-app --app-id AMPLIFY_APP_ID </span><span class=\"token parameter variable\" style=\"color:#36acaa\">--repository</span><span class=\"token plain\"> REPOSITORY_URL --access-token ACCESS_TOKEN</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copiar c√≥digo para a √°rea de transfer√™ncia\" title=\"Copiar\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p><code>AMPLIFY_APP_ID</code>: para encontrar a ID da sua aplica√ß√£o, acesse o console do Amplify. Em App settings (Configura√ß√µes do aplicativo), clique em General (Geral) e procure o ARN da aplica√ß√£o. A ID da aplica√ß√£o √© a sequ√™ncia alfanum√©rica no final do ARN. A ID √© mostrada como REDACTED na imagem abaixo:</p>\n<br>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Amplify App Id\" src=\"https://magmanu.github.io/blog/pt-BR/assets/images/amplify_data-ed02eb0516b95e7d3782a0b619920733.webp\" width=\"1400\" height=\"459\" class=\"img_ev3q\"></p>\n<br>\n<p><code>REPOSITORY_URL</code>: √â o URL que voc√™ usou na etapa 5 da migra√ß√£o.<br>\n<code>ACCESS_TOKEN</code>: o token de acesso √© um token que voc√™ pode gerar no GitHub. Pode ser o PAT (token de acesso pessoal) de quem administra o repo, mas se for um projeto profissional, prefira usar um <a href=\"https://docs.github.com/pt/apps/creating-github-apps/authenticating-with-a-github-app/generating-a-user-access-token-for-a-github-app\" target=\"_blank\" rel=\"noopener noreferrer\">token de acesso do usu√°rio gerado por um app no GitHub</a>.</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"reautentique-o-app-amplify\">Reautentique o app Amplify<a href=\"https://magmanu.github.io/blog/pt-BR/tech/migrate-codecommit-to-github#reautentique-o-app-amplify\" class=\"hash-link\" aria-label=\"Link direto para Reautentique o app Amplify\" title=\"Link direto para Reautentique o app Amplify\">‚Äã</a></h3>\n<div class=\"theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success\"><div class=\"admonitionHeading_Gvgb\"><span class=\"admonitionIcon_Rf37\"><svg viewBox=\"0 0 12 16\"><path fill-rule=\"evenodd\" d=\"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z\"></path></svg></span>XP da vida real</div><div class=\"admonitionContent_BuS1\"><p>As empresas podem restringir bastante quais apps s√£o aprovados no GitHub. Se por algum motivo o app Amplify n√£o for aprovado, pule para a se√ß√£o <a href=\"https://magmanu.github.io/blog/pt-BR/tech/migrate-codecommit-to-github#a-abordagem-via-webhook\">\"A abordagem via Webhook\"</a>.</p></div></div>\n<p>Agora voc√™ pode reconectar sua aplica√ß√£o. Na mesma p√°gina em que obteve o ARN, acima do ARN tem o bot√£o ‚ÄúReconnect repository‚Äù (Reconectar reposit√≥rio). Ao clicar nele, a p√°gina de aprova√ß√£o no GitHub √© aberta.</p>\n<ul>\n<li><strong>Se o reposit√≥rio migrado N√ÉO estiver em uma Organiza√ß√£o</strong>, clique no bot√£o ‚ÄúAuthorize aws-amplify-console‚Äù (Autorizar aws-amplify-console). O console do Amplify vai abrir, e l√° voc√™ pode selecionar o repo. Pronto, fim.</li>\n<li><strong>Se o reposit√≥rio migrado estiver em uma Organiza√ß√£o</strong>, clique no bot√£o para solicitar a permiss√£o OAuth para o app Amplify. Uma mensagem de solicita√ß√£o pendente fica dispon√≠vel at√© que a administra√ß√£o a aprove (voc√™ vai receber um e-mail quando isso acontecer).</li>\n</ul>\n<br>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Authorize Amplify Github App\" src=\"https://magmanu.github.io/blog/pt-BR/assets/images/authorize_amplify_app-0c09d0e0746dd8ee0e5bf2f70539c74a.webp\" width=\"1186\" height=\"1206\" class=\"img_ev3q\"></p>\n<br>\n<p>Depois da aprova√ß√£o, volte para o app Amplify e clique em ‚ÄúReconnect repository‚Äù (Reconectar reposit√≥rio) novamente. Os repos da sua organiza√ß√£o e da sua pr√≥pria conta aparecem, para voc√™ escolher um deles. Fim.</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"a-abordagem-via-webhook\">A Abordagem via Webhook<a href=\"https://magmanu.github.io/blog/pt-BR/tech/migrate-codecommit-to-github#a-abordagem-via-webhook\" class=\"hash-link\" aria-label=\"Link direto para A Abordagem via Webhook\" title=\"Link direto para A Abordagem via Webhook\">‚Äã</a></h3>\n<p>Se voc√™ n√£o puder usar o app Amplify no GitHub, voc√™ pode usar um webhook. Para isso, em App settings (Configura√ß√µes do aplicativo), clique em General (Geral), selecione Build Settings (Configura√ß√µes de compila√ß√£o) e clique em Create Webhook (Criar Webhook),  ambos mostrados em laranja abaixo.</p>\n<br>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Amplify Build Settings\" src=\"https://magmanu.github.io/blog/pt-BR/assets/images/amplify_build_settings-937fb3f3220996941f487bd5ed440afe.webp\" width=\"1181\" height=\"295\" class=\"img_ev3q\"></p>\n<br>\n<p>No pop-up, digite um nome e selecione um branch para fazer o build. O novo webhook ser√° exibido na interface do Amplify. Copie o URL porque vamos precisar dele no GitHub.</p>\n<br>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Amplify Incming Webhooks\" src=\"https://magmanu.github.io/blog/pt-BR/assets/images/amplify_incoming_webhooks-e4c6bd369f275c88df521b33d531b072.webp\" width=\"769\" height=\"234\" class=\"img_ev3q\"></p>\n<br>\n<p>Agora volte para o repo no GitHub, selecione Configura√ß√µes &gt; Webhooks e clique no bot√£o Add webhook (Adicionar webhook).</p>\n<br>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Adding GitHub Webhooks\" src=\"https://magmanu.github.io/blog/pt-BR/assets/images/github_webhooks-143154a73be16465c0004e7d5de274d3.webp\" width=\"1264\" height=\"868\" class=\"img_ev3q\"></p>\n<p>Acabou, finalmente.</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"limita√ß√µes-do-webhook\">Limita√ß√µes do webhook<a href=\"https://magmanu.github.io/blog/pt-BR/tech/migrate-codecommit-to-github#limita%C3%A7%C3%B5es-do-webhook\" class=\"hash-link\" aria-label=\"Link direto para Limita√ß√µes do webhook\" title=\"Link direto para Limita√ß√µes do webhook\">‚Äã</a></h3>\n<p>Se voc√™ usar o webhook, lembre-se de que:</p>\n<ul>\n<li>Se precisar conectar v√°rios branches ao Amplify, voc√™ vai precisar de um webhook no Amplify para cada branch, e vai precisar adicionar cada webhook ao GitHub, um por um. Se bater a tenta√ß√£o de fazer um script, converse com a galera que faz admin do Github na sua empresa e tenta aprovar o app Amplify. Ningu√©m merece viver na gambiarra.</li>\n<li>Qualquer git push vai espoletar (trigger) o webhook em cada deploy no Amplify. Em outras palavras, se voc√™ tiver as branches ‚Äúmain‚Äù, ‚Äúrelease‚Äù, ‚Äúdev‚Äù, ‚Äúfeature/a‚Äù e ‚Äúfeature/b‚Äù, toda vez que algu√©m fizer um push em ‚Äúdev‚Äù, a pipeline vai espoletar em todas as cinco branches.</li>\n</ul>\n<p>Espero ter sido √∫til, at√© mais!</p>",
            "url": "https://magmanu.github.io/blog/pt-BR/tech/migrate-codecommit-to-github",
            "title": "Como Migrar do CodeCommit para o GitHub ‚Äî Mantendo sua pipeline Amplify",
            "summary": "Este tutorial inclui orienta√ß√µes para tr√™s cen√°rios de administra√ß√£o no GitHub:",
            "date_modified": "2021-10-13T00:00:00.000Z",
            "author": {
                "name": "Manu Magalh√£es",
                "url": "https://github.com/magmanu"
            },
            "tags": [
                "infra",
                "github",
                "amplify",
                "aws",
                "ci/cd",
                "tutorial"
            ]
        }
    ]
}