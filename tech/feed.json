{
    "version": "https://jsonfeed.org/version/1",
    "title": "Code, Cloud, App Security and more",
    "home_page_url": "https://magmanu.github.io/blog/tech",
    "description": "A Journey in Tech",
    "items": [
        {
            "id": "https://magmanu.github.io/blog/tech/matrices-github-actions",
            "content_html": "<p><em>Listen, I feel the boldest of girls for calling this <em>an</em> ultimate guide. But it's just because this will be the one post about matrices I'll update over time as I experience more. All info in a single place for easier retrieval, enjoy!</em></p>\n<p>Matrices keep workflows DRY: you setup a job once and let the matrix do the boring work of multiplying it with all the different configurations required.</p>\n<h3>An Ultimate Guide</h3>\n<!-- -->\n<div class=\"tableOfContentsInline_prmo\"><ul class=\"table-of-contents\"><li><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#basics-simple-matrix\">Basics: Simple Matrix</a></li><li><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#multidimensional-matrices-matrix-with-multiple-keys\">Multidimensional Matrices (Matrix with Multiple Keys)</a></li><li><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#adjusting-matrices-with-include--exclude-part-i-the-odd-job\">Adjusting matrices with <code>include</code> &amp; <code>exclude</code>, part I: the \"odd job\"</a><ul><li><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#static-usage\">Static usage</a></li><li><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#the-declarative-case-include-as-a-flattenning-tool\">The Declarative Case: <code>include</code> as a flattenning tool</a></li><li><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#dynamic-exclusions\">Dynamic exclusions</a></li></ul></li><li><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#adjusting-matrices-with-include--exclude-part-ii-the-small-print\">Adjusting matrices with <code>include</code> &amp; <code>exclude</code>, part II: the small print</a><ul><li><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#what-include-doesnt-do\">What <code>include</code> doesn't do</a></li><li><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#advice-for-usinginclude\">Advice for using<code>include</code></a></li></ul></li><li><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#case-study-more-complex-matrices\">Case Study: More Complex Matrices</a><ul><li><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#the-declarative-approach\">The declarative approach</a></li><li><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#the-includeexclude-approach\">The <code>include</code>/<code>exclude</code> approach</a></li></ul></li><li><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#simplifying-particular-combinations-in-matrices\">Simplifying \"particular combinations\" in matrices</a></li><li><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#handling-glitches-in-the-matrix\">Handling glitches in the matrix</a><ul><li><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#matrix-job-failures\">Matrix job failures</a></li><li><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#dynamically-generated-matrices-handling-empty-matrix-error\">Dynamically-generated matrices: Handling Empty Matrix Error</a></li></ul></li></ul></div>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"basics-simple-matrix\">Basics: Simple Matrix<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#basics-simple-matrix\" class=\"hash-link\" aria-label=\"Direct link to Basics: Simple Matrix\" title=\"Direct link to Basics: Simple Matrix\">​</a></h2>\n<p>Use a matrix to run the same job multiple times, with different configurations.</p>\n<p>Matrices are set at the job level, under the <code>strategy</code> key. Then, at the step level, reference the matrix values with <code>${{ matrix.key_name}}</code>.</p>\n<p>Let's follow the classic workflow example, of course: running CI tests in different versions of Node.js.</p>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show code</p></summary><div><div class=\"collapsibleContent_i85q\"><div><div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">.github/workflows/testing.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm\"><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">(</span><span class=\"token punctuation\" style=\"color:#393A34\">...</span><span class=\"token plain\">)</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\"></span><span class=\"token key atrule\" style=\"color:#00a4db\">jobs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">unit-tests</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">strategy</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># I named it `node-version`, but you can name it however you want</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">16</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"> </span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Checkout</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        (</span><span class=\"token punctuation\" style=\"color:#393A34\">...</span><span class=\"token plain\">)</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\" style=\"display:inline-block\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># And to reference it, use `${{ matrix.key_name}}`</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Use Node.js $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.node</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">version </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">uses</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> actions/setup</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">node@v4</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">with</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.node</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">version </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\" style=\"display:inline-block\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      (</span><span class=\"token punctuation\" style=\"color:#393A34\">...</span><span class=\"token plain\">)</span></span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div></div></div></div></details>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show pipeline</p></summary><div><div class=\"collapsibleContent_i85q\"><div><p><img decoding=\"async\" loading=\"lazy\" alt=\"screenshot\" src=\"https://magmanu.github.io/blog/assets/images/screenshot_13-dbe2b35893fc8c71efef371454d33c33.png\" width=\"624\" height=\"436\" class=\"img_ev3q\"></p></div></div></div></details>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"multidimensional-matrices-matrix-with-multiple-keys\">Multidimensional Matrices (Matrix with Multiple Keys)<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#multidimensional-matrices-matrix-with-multiple-keys\" class=\"hash-link\" aria-label=\"Direct link to Multidimensional Matrices (Matrix with Multiple Keys)\" title=\"Direct link to Multidimensional Matrices (Matrix with Multiple Keys)\">​</a></h2>\n<p>Of course this can get more complex. If you want to run your tests in Node.js 16 &amp; 18, <strong>and</strong> test each node version in a different OS, you can use a matrix with multiple keys (aka matrix of matrices, or multidimensional matrices).</p>\n<p>Please note: in a matrix of matrices, the number of jobs is the product of the matrix sizes - that is, the number of items in matrix A multiplied by the number of items in matrix B.</p>\n<p>So if we specify two node versions and two OSs, like this...</p>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">.github/workflows/testing.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm\"><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">16</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span></span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>... we'll end up with 4 jobs (2*2):</p>\n<ul>\n<li>ubuntu-latest + node 16</li>\n<li>ubuntu-latest + node 18</li>\n<li>windows-latest + node 16</li>\n<li>windows-latest + node 18</li>\n</ul>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show code</p></summary><div><div class=\"collapsibleContent_i85q\"><div><div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">.github/workflows/testing.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm\"><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">(</span><span class=\"token punctuation\" style=\"color:#393A34\">...</span><span class=\"token plain\">)</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">unit-tests</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">strategy</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">16</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.os </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Checkout</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        (</span><span class=\"token punctuation\" style=\"color:#393A34\">...</span><span class=\"token plain\">)</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\" style=\"display:inline-block\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Use Node.js $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.node</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">version </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"> in $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.os </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">uses</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> actions/setup</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">node@v2</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">with</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.node</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">version </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\" style=\"display:inline-block\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      (</span><span class=\"token punctuation\" style=\"color:#393A34\">...</span><span class=\"token plain\">)</span></span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div></div></div></div></details>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show pipeline</p></summary><div><div class=\"collapsibleContent_i85q\"><div><p><img decoding=\"async\" loading=\"lazy\" alt=\"screenshot\" src=\"https://magmanu.github.io/blog/assets/images/screenshot_14-607ec4e34cabe7d266a6c6cd502f4a66.png\" width=\"628\" height=\"616\" class=\"img_ev3q\"></p></div></div></div></details>\n<p>You can have as many keys you want, but keep in mind that the number of jobs <strong>can grow exponentially</strong>. For example, if you have 4 matrices keys with 3 values each, you'll end up with 81 jobs (3*3*3*3).</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"adjusting-matrices-with-include--exclude-part-i-the-odd-job\">Adjusting matrices with <code>include</code> &amp; <code>exclude</code>, part I: the \"odd job\"<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#adjusting-matrices-with-include--exclude-part-i-the-odd-job\" class=\"hash-link\" aria-label=\"Direct link to adjusting-matrices-with-include--exclude-part-i-the-odd-job\" title=\"Direct link to adjusting-matrices-with-include--exclude-part-i-the-odd-job\">​</a></h2>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"static-usage\">Static usage<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#static-usage\" class=\"hash-link\" aria-label=\"Direct link to Static usage\" title=\"Direct link to Static usage\">​</a></h3>\n<p>If you know beforehand all the matrix values you'll use, you can set them statically.</p>\n<p>Let's say your team will also run tests for Node.js 18 in Windows machines. There are two ways to handle this:</p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"include\"><code>include</code><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#include\" class=\"hash-link\" aria-label=\"Direct link to include\" title=\"Direct link to include\">​</a></h4>\n<p>With <code>include</code>, you can <strong>add</strong> an \"odd value\" to your matrix.<br>\n<!-- -->Below, we'll write a matrix for combinations between the Ubuntu OS and two Node.js versions, and use <code>include</code> to add the odd <code>windows-latest</code> + Node.js <code>18</code> combination.</p>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show code</p></summary><div><div class=\"collapsibleContent_i85q\"><div><div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">.github/workflows/testing.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm\"><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">(</span><span class=\"token punctuation\" style=\"color:#393A34\">...</span><span class=\"token plain\">)</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">unit-tests</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">strategy</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">16</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">include</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># add the odd combination</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.os </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        (</span><span class=\"token punctuation\" style=\"color:#393A34\">...</span><span class=\"token plain\">)</span></span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div></div></div></div></details>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"exclude\"><code>exclude</code><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#exclude\" class=\"hash-link\" aria-label=\"Direct link to exclude\" title=\"Direct link to exclude\">​</a></h4>\n<p><code>exclude</code> works in the opposite direction: you add all values to the matrix and use <code>exclude</code> to <strong>remove</strong> the undesirable matches.</p>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show code</p></summary><div><div class=\"collapsibleContent_i85q\"><div><div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">.github/workflows/testing.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm\"><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">(</span><span class=\"token punctuation\" style=\"color:#393A34\">...</span><span class=\"token plain\">)</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">unit-tests</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">strategy</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">16</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">exclude</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># remove unwanted combination</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">16</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.os </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        (</span><span class=\"token punctuation\" style=\"color:#393A34\">...</span><span class=\"token plain\">)</span></span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div></div></div></div></details>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show pipeline: the pipeline looks the same in both cases</p></summary><div><div class=\"collapsibleContent_i85q\"><div><p>Now there are only 3 jobs - also, the job completion for windows went down from 1m23/1m35s to 44s thanks to caching :)</p><p><img decoding=\"async\" loading=\"lazy\" alt=\"screenshot\" src=\"https://magmanu.github.io/blog/assets/images/screenshot_15-66b240a0cec4ffc486515515d4162e6c.png\" width=\"552\" height=\"466\" class=\"img_ev3q\"></p></div></div></div></details>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"the-declarative-case-include-as-a-flattenning-tool\">The Declarative Case: <code>include</code> as a flattenning tool<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#the-declarative-case-include-as-a-flattenning-tool\" class=\"hash-link\" aria-label=\"Direct link to the-declarative-case-include-as-a-flattenning-tool\" title=\"Direct link to the-declarative-case-include-as-a-flattenning-tool\">​</a></h3>\n<p>If you prefer clarity over brevity, you can use <code>include</code> to flatten matrices. Just beware that this can make your workflow harder to maintain.</p>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show code</p></summary><div><div class=\"collapsibleContent_i85q\"><div><p><img decoding=\"async\" loading=\"lazy\" alt=\"screenshot\" src=\"https://magmanu.github.io/blog/assets/images/screenshot_1-2416938c95afe7c3eb25bb223ae6e44a.png\" width=\"1642\" height=\"486\" class=\"img_ev3q\"></p></div></div></div></details>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"dynamic-exclusions\">Dynamic exclusions<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#dynamic-exclusions\" class=\"hash-link\" aria-label=\"Direct link to Dynamic exclusions\" title=\"Direct link to Dynamic exclusions\">​</a></h3>\n<p>This is my favourite. You can use <code>exclude</code> to dynamically adjust matrix values.</p>\n<p>Let's suppose your team decides that every Tuesday you will run tests in the most recent Node.js version, as a peek into changes you'll have to make in the future. You can use <code>include</code> to run the new version to the matrix <em>only on Tuesdays</em>.</p>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show code</p></summary><div><div class=\"collapsibleContent_i85q\"><div><div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">.github/workflows/testing.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm\"><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">jobs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">get_weekday</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">outputs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">WEEKDAY</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> steps.get_weekday.outputs.WEEKDAY </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Get day of the week</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">id</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> get_weekday</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> echo \"WEEKDAY=$(date '+%a')\" </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token plain\"> tee </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">a \"$GITHUB_OUTPUT\"</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\" style=\"display:inline-block\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">unit-tests</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">needs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> get_weekday</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">strategy</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">16</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">24</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">exclude</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> needs.get_weekday.outputs.WEEKDAY </span><span class=\"token tag\" style=\"color:#00009f\">!=</span><span class=\"token plain\"> 'Tue' </span><span class=\"token important\">&amp;&amp;</span><span class=\"token plain\"> 24 </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token plain\"> '' </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Run unit tests</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token scalar string\" style=\"color:#e3116c\">            echo \"Today is ${{ needs.get_weekday.outputs.WEEKDAY }}.\"</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token scalar string\" style=\"color:#e3116c\">            echo \"Let's run tests for Node.js v${{ matrix.node-version }}\"</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      (</span><span class=\"token punctuation\" style=\"color:#393A34\">...</span><span class=\"token plain\">)</span></span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div></div></div></div></details>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show pipeline</p></summary><div><div class=\"collapsibleContent_i85q\"><div><p><img decoding=\"async\" loading=\"lazy\" alt=\"screenshot\" src=\"https://magmanu.github.io/blog/assets/images/screenshot_2-92f6c249ef0af083a25cb8d73c07629d.png\" width=\"1498\" height=\"726\" class=\"img_ev3q\"></p></div></div></div></details>\n<p>You may have noticed this funny syntax: <code>${{ needs.get_weekday.outputs.WEEKDAY != 'Tue' &amp;&amp; 24 || '' }}</code>. This is a way to <a href=\"https://docs.github.com/en/actions/learn-github-actions/expressions#:~:text=ternary,expressions\" target=\"_blank\" rel=\"noopener noreferrer\">use ternaries in Github Actions</a>. If the weekday <em>is not</em> Tuesday, this expression will return <code>24</code>, meaning that <code>24</code> will be excluded from the <code>node-version</code> array values. But, on Tuesdays, this expression will return an empty value =&gt; <code>24</code> will not be excluded =&gt;  all node-versions set in the base matrix run =&gt; Node.js 24 will run.</p>\n<p>Now, why <code>exclude</code> instead of <code>include</code>?<br>\n<!-- -->Honestly, I haven't found a decent way to get <code>included</code> to work with this use case. With <code>include</code>, the syntax would be dreadful:  We have to use a ternary both for key and value. You sure you want... this thing below? I sure don't.</p>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token key atrule\" style=\"color:#00a4db\">include</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">\"${{needs.get_weekday.outputs.WEEKDAY != 'Tue' &amp;&amp; 'node-version' || ''}}\"</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"${{needs.get_weekday.outputs.WEEKDAY != 'Tue' &amp;&amp; 24 || ''}}\"</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"adjusting-matrices-with-include--exclude-part-ii-the-small-print\">Adjusting matrices with <code>include</code> &amp; <code>exclude</code>, part II: the small print<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#adjusting-matrices-with-include--exclude-part-ii-the-small-print\" class=\"hash-link\" aria-label=\"Direct link to adjusting-matrices-with-include--exclude-part-ii-the-small-print\" title=\"Direct link to adjusting-matrices-with-include--exclude-part-ii-the-small-print\">​</a></h2>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"what-include-doesnt-do\">What <code>include</code> doesn't do<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#what-include-doesnt-do\" class=\"hash-link\" aria-label=\"Direct link to what-include-doesnt-do\" title=\"Direct link to what-include-doesnt-do\">​</a></h3>\n<p>First, let's see what you <strong>cannot/should not</strong> do with <code>include</code>:</p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"include-doesnt-inherit-the-matrix-keyvalue-pairs\"><code>include</code> doesn't inherit the matrix key/value pairs<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#include-doesnt-inherit-the-matrix-keyvalue-pairs\" class=\"hash-link\" aria-label=\"Direct link to include-doesnt-inherit-the-matrix-keyvalue-pairs\" title=\"Direct link to include-doesnt-inherit-the-matrix-keyvalue-pairs\">​</a></h4>\n<p>Just because a key/value pair is present in the matrix, it doesn't mean <code>include</code> inherits it.</p>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">strategy</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">Asia</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">include</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> macos</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.os </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.node</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">version </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.region </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"OS: ${{ matrix.os }}\"</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"Node Version: ${{ matrix.node-version }}\"</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"Region: ${{ matrix.region }}\"</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>In this example, because you haven't defined a <code>node-version</code> or <code>region</code> in your include map, those values will be empty in the included job.</p>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show pipeline</p></summary><div><div class=\"collapsibleContent_i85q\"><div><p><img decoding=\"async\" loading=\"lazy\" alt=\"screenshot\" src=\"https://magmanu.github.io/blog/assets/images/screenshot_16-c76460ae942b5475c4372982d2e2be05.png\" width=\"2180\" height=\"576\" class=\"img_ev3q\"></p></div></div></div></details>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"array-values-for-include-do-not-spread-into-separate-jobs\">Array values for <code>include</code> do not spread into separate jobs<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#array-values-for-include-do-not-spread-into-separate-jobs\" class=\"hash-link\" aria-label=\"Direct link to array-values-for-include-do-not-spread-into-separate-jobs\" title=\"Direct link to array-values-for-include-do-not-spread-into-separate-jobs\">​</a></h4>\n<p>In this example, the <code>region</code> array  <strong>will not</strong> spin a <code>macos-latest</code> job for each region. The <code>include</code> will spin a <strong>single</strong> MacOS job that takes the whole array as the value for <code>region</code>, as you can see in the screenshot below. You can, however, extract the values from the array using the bracket notation <code>matrix.region[0]</code>.</p>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">strategy</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">Asia</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">include</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> macos</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">Asia</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.os </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.region </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"OS: ${{ matrix.os }}\"</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"Node Version: ${{ matrix.node-version }}\"</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"First Region: ${{ matrix.region[0] }}\"</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"Second Region: ${{ matrix.region[1] }}\"</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show pipeline</p></summary><div><div class=\"collapsibleContent_i85q\"><div><p><img decoding=\"async\" loading=\"lazy\" alt=\"screenshot\" src=\"https://magmanu.github.io/blog/assets/images/screenshot_17-2b6284109a2f9ee70a935d6a26ae7568.png\" width=\"2184\" height=\"626\" class=\"img_ev3q\"></p></div></div></div></details>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"advice-for-usinginclude\">Advice for using<code>include</code><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#advice-for-usinginclude\" class=\"hash-link\" aria-label=\"Direct link to advice-for-usinginclude\" title=\"Direct link to advice-for-usinginclude\">​</a></h3>\n<p>Now, what you <strong>can/must</strong> do with <code>include</code>, some of which you might have guessed already from the previous points.</p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"be-explicit-about-all-desired-keyvalue-pairs-to-the-matrix\">Be explicit about all desired key/value pairs to the matrix<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#be-explicit-about-all-desired-keyvalue-pairs-to-the-matrix\" class=\"hash-link\" aria-label=\"Direct link to Be explicit about all desired key/value pairs to the matrix\" title=\"Direct link to Be explicit about all desired key/value pairs to the matrix\">​</a></h4>\n<p>If you want a key/value pair in <code>include</code>, well... include it. It won't magically appear by inheritance.</p>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">strategy</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">Asia</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">include</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> macos</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">20</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Asia</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.os </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.node</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">version </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.region </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"OS: ${{ matrix.os }}\"</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"Node Version: ${{ matrix.node-version }}\"</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"Region: ${{ matrix.region }}\"</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"each-include-map-is-an-independent-unit\">Each <code>include</code> map is an independent unit<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#each-include-map-is-an-independent-unit\" class=\"hash-link\" aria-label=\"Direct link to each-include-map-is-an-independent-unit\" title=\"Direct link to each-include-map-is-an-independent-unit\">​</a></h4>\n<p>In the previous example, the <code>macos-latest</code> job was only added to the <code>Asia</code> region.\nIf you want  <code>macos-latest</code> for <code>Asia</code> and <code>Latam</code>, you need to add an <code>include</code> map for each of them. Do not try to combine them in a single map, that's not how <code>include</code> works.</p>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">strategy</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">Asia</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">include</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> macos</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">20</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Asia</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> macos</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">20</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Latam</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.os </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.node</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">version </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.region </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"OS: ${{ matrix.os }}\"</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"Node Version: ${{ matrix.node-version }}\"</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"Region: ${{ matrix.region }}\"</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"feel-free-to-add-brand-new-keys-not-present-in-the-base-matrix\">Feel free to add brand new keys not present in the base matrix<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#feel-free-to-add-brand-new-keys-not-present-in-the-base-matrix\" class=\"hash-link\" aria-label=\"Direct link to Feel free to add brand new keys not present in the base matrix\" title=\"Direct link to Feel free to add brand new keys not present in the base matrix\">​</a></h4>\n<p>You're not restricted to modifying keys that already exist in the base matrix. You can add new ones too. Just keep in mind that \"new\" keys will be added to *<em>all</em> jobs in the matrix.</p>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">strategy</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">Asia</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">include</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">report</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean important\" style=\"color:#36acaa\">true</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.os </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.node</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">version </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.region </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.report </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"OS: ${{ matrix.os }}\"</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"Node Version: ${{ matrix.node-version }}\"</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"Region: ${{ matrix.region }}\"</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"Should report: ${{ matrix.report }}\"</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show pipeline</p></summary><div><div class=\"collapsibleContent_i85q\"><div><p>Repating, just to highlight it:</p><ul>\n<li>When the keys of an <code>include</code> map don't match any keys in the base matrix (as in the example above), <strong>that new key will be added to every job in the matrix</strong>.</li>\n</ul><p><img decoding=\"async\" loading=\"lazy\" alt=\"screenshot\" src=\"https://magmanu.github.io/blog/assets/images/screenshot_18-798ba88950c2dd2e411caa5a9e8bf9ba.png\" width=\"1379\" height=\"730\" class=\"img_ev3q\"></p></div></div></div></details>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"case-study-more-complex-matrices\">Case Study: More Complex Matrices<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#case-study-more-complex-matrices\" class=\"hash-link\" aria-label=\"Direct link to Case Study: More Complex Matrices\" title=\"Direct link to Case Study: More Complex Matrices\">​</a></h2>\n<p>When real life complexity knocks at your door, <code>include</code> and <code>exclude</code> can become confusing. I'll walk you through an implementation example to help you reason through your options.</p>\n<p>Let's take the following scenario: you need to run tests for your product, but different regions have different requirements for the test suite. But they have one thing in common: both regions require that you produce a report for all tests. Here are your specs:</p>\n<p>Asia Region:</p>\n<ul>\n<li>run tests for Node.js 18 in Ubuntu and Windows</li>\n<li>run tests for Node.js 20 in Ubuntu and MacOs</li>\n</ul>\n<p>Latam Region:</p>\n<ul>\n<li>run tests for Node.js 18 in Ubuntu and Windows</li>\n<li>run tests for Node.js 20 in Ubuntu only</li>\n<li>run tests for Node.js 22 in Windows, Ubuntu and MacOs</li>\n</ul>\n<p>Export test report:</p>\n<ul>\n<li>Adds a variable to the matrix to indicate if the test report should be exported. Your requirement is that all tests should output a report.</li>\n</ul>\n<p>For clarity, I'll spell out what jobs will run for each product:</p>\n<table><thead><tr><th>Config</th><th>Windows</th><th>Ubuntu</th><th>MacOs</th></tr></thead><tbody><tr><td>Region: Asia</td><td>18</td><td>18, 20</td><td>20</td></tr><tr><td>Region: Latam</td><td>18, 22</td><td>18, 20, 22</td><td>22</td></tr></tbody></table>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"the-declarative-approach\">The declarative approach<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#the-declarative-approach\" class=\"hash-link\" aria-label=\"Direct link to The declarative approach\" title=\"Direct link to The declarative approach\">​</a></h3>\n<p>With this approach, you make each combination very explicit. It's quite easy to see how this can get a bit out of hand as your test suite grows.</p>\n<p>But there's a silly trick to make it less awful to read: just tweak the <code>include</code> syntax using curly brackets. This is my favourite notation for matrices, as the visual pattern makes the reading more manageable.</p>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show code</p></summary><div><div class=\"collapsibleContent_i85q\"><div><div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">.github/workflows/testing.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm\"><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">(</span><span class=\"token punctuation\" style=\"color:#393A34\">...</span><span class=\"token plain\">)</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">unit-tests</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">strategy</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">include</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Asia</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">report</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean important\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">report</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean important\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">22</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">report</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean important\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Asia</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">report</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean important\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">report</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean important\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">20</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Asia</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">report</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean important\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">20</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">report</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean important\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">22</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">report</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean important\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> macos</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">20</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Asia</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">report</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean important\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> macos</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">22</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">report</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean important\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.os </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Run tests</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"> </span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"Running tests for Node.js ${{ matrix.node-version }} in ${{ matrix.os }} for product ${{ matrix.product }}\"</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"Should report: ${{ matrix.report }}\"</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      (</span><span class=\"token punctuation\" style=\"color:#393A34\">...</span><span class=\"token plain\">)</span></span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div></div></div></div></details>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"the-includeexclude-approach\">The <code>include</code>/<code>exclude</code> approach<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#the-includeexclude-approach\" class=\"hash-link\" aria-label=\"Direct link to the-includeexclude-approach\" title=\"Direct link to the-includeexclude-approach\">​</a></h3>\n<p>Some people might prefer this approach, but it requires a little training to tell what specific jobs will be actually spinned up.</p>\n<p>In this example, we will build our base matrix with all applicable values:</p>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">.github/workflows/testing.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> macos</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">20</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">22</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">Asia</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p><em>As an exercise, how many jobs do we have there?</em></p>\n<div class=\"codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-text codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">os_length (3) * node-version_length (3) * region_length (2) = 18</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Then we can proceed to trim it down to the desired cases only.<br>\n<!-- -->Keep in mind that <code>include</code> is processed after <code>exclude</code>, so we can use <code>include</code> to add back combinations that were previously excluded.</p>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> macos</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">20</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">22</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">Asia</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">exclude</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">22</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Asia</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">                        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># Asia has no case for Node.js 22 (-3 jobs)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> macos</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">                    </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># MacOs won't test Node.js 18 (-2 jobs)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">20</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Asia</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># Windows is the only case without Node.js 20 in Asia (-1 job)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">20</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">                       </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># There's only one case for Node 20 in Latam, we'll readd it later (-3 jobs)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">include</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">20</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># Re-adding the case for Node 20 in Latam (+1 job)</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show pipeline</p></summary><div><div class=\"collapsibleContent_i85q\"><div><p><img decoding=\"async\" loading=\"lazy\" alt=\"screenshot\" src=\"https://magmanu.github.io/blog/assets/images/screenshot_19-a693471453e522da0174cc92dc9996b1.png\" width=\"650\" height=\"882\" class=\"img_ev3q\"></p></div></div></div></details>\n<p>And finally, because the report should be added to all cases, we can add <code>report</code> under <code>include</code>:</p>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> macos</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">20</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">22</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">Asia</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">exclude</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">22</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Asia</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> macos</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">20</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Asia</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> windows</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">20</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">include</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">20</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">region</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Latam</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">os</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># doesn't add new jobs, just adds this key to all jobs</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">report</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean important\" style=\"color:#36acaa\">true</span><span class=\"token plain\"> </span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show pipeline</p></summary><div><div class=\"collapsibleContent_i85q\"><div><p><img decoding=\"async\" loading=\"lazy\" alt=\"screenshot\" src=\"https://magmanu.github.io/blog/assets/images/screenshot_20-d9a696031344015a590f1f1954f54299.png\" width=\"1422\" height=\"912\" class=\"img_ev3q\"></p></div></div></div></details>\n<p>And that's how we end with our 10 desired jobs.</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"simplifying-particular-combinations-in-matrices\">Simplifying \"particular combinations\" in matrices<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#simplifying-particular-combinations-in-matrices\" class=\"hash-link\" aria-label=\"Direct link to Simplifying &quot;particular combinations&quot; in matrices\" title=\"Direct link to Simplifying &quot;particular combinations&quot; in matrices\">​</a></h2>\n<p>If you're using multidimensional matrices, the more configurations you set, the more difficult it is to handle outliers. So here's a trick I learned from <a href=\"https://seankilleen.com/2023/08/how-to-specify-pairs-of-items-in-github-actions-matrix-strategies/\" target=\"_blank\" rel=\"noopener noreferrer\">Sean Killeen's blog</a>: instead of using <code>include</code>, <code>exclude</code> and whatnot, you can use maps to easily group key/value pairs that usually go together but don't quite fit a matrix context because they are too tighly coupled. It won't work for all cases, but will be a good solution for plenty of them:</p>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">.github/workflows/sean.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm\"><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token key atrule\" style=\"color:#00a4db\">jobs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">build_release</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Build and Release\"</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">strategy</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">VERSIONS</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">ruby</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> 2.7.3</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">ghpages</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">226</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token key atrule\" style=\"color:#00a4db\">ruby</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> 2.7.4</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">ghpages</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">228</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"> </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># tight coupling between rub and ghpages versions, not very \"matrixy\"</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">NODE_MAJOR_VERSION</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">16</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token number\" style=\"color:#36acaa\">20</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">env</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">NODE_MAJOR_VERSION</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.NODE_MAJOR_VERSION </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">RUBY_VERSION</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.VERSIONS.ruby </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">GITHUB_PAGES_VERSION</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.VERSIONS.ghpages </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span></span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>--&gt;</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"handling-glitches-in-the-matrix\">Handling glitches in the matrix<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#handling-glitches-in-the-matrix\" class=\"hash-link\" aria-label=\"Direct link to Handling glitches in the matrix\" title=\"Direct link to Handling glitches in the matrix\">​</a></h2>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"matrix-job-failures\">Matrix job failures<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#matrix-job-failures\" class=\"hash-link\" aria-label=\"Direct link to Matrix job failures\" title=\"Direct link to Matrix job failures\">​</a></h3>\n<p>It's true that jobs run in parallel and are independent of each other. But when they are spin up by a matrix, by default, all are cancelled if one of them fails. This is not always desirable, so you can change that behaviour.</p>\n<table><thead><tr><th>Option</th><th>Scope</th><th>Effects</th></tr></thead><tbody><tr><td><code>fail-fast: &lt;boolean&gt;</code></td><td>Entire matrix</td><td>Default: <code>true</code>. Determines if <strong>all</strong> ongoing and queued matrix jobs will be cancelled if one job fails</td></tr><tr><td><code>continue-on-error: &lt;boolean&gt;</code></td><td>Job level</td><td>Determines if a failure on a job will bypass <code>fail-fast: true</code></td></tr><tr><td><code>matrix.experimental: &lt;boolean&gt;</code></td><td>Job level</td><td>Allows jobs to have different <code>continue-on-error</code> values</td></tr></tbody></table>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">.github/workflows/testing.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm\"><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token key atrule\" style=\"color:#00a4db\">jobs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">unit-tests</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">continue-on-error</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean important\" style=\"color:#36acaa\">false</span><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># default value, can be ommited</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">strategy</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">fail-fast</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean important\" style=\"color:#36acaa\">true</span><span class=\"token plain\">           </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># default value, can be ommited</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">14</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">16</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      (</span><span class=\"token punctuation\" style=\"color:#393A34\">...</span><span class=\"token plain\">)</span></span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"fail-fast\"><code>fail-fast</code><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#fail-fast\" class=\"hash-link\" aria-label=\"Direct link to fail-fast\" title=\"Direct link to fail-fast\">​</a></h4>\n<p><code>fail-fast</code> is  pretty straightforward. <code>true</code> will short-circuit the matrix if one job fails; <code>false</code> makes all jobs run independently of each other regardless of job failures.</p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"continue-on-error\"><code>continue-on-error</code><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#continue-on-error\" class=\"hash-link\" aria-label=\"Direct link to continue-on-error\" title=\"Direct link to continue-on-error\">​</a></h4>\n<p><code>continue-on-error</code> is a way to add an exclusion to the <code>fail-fast</code> setting.</p>\n<p>A matrix with <code>fail-fast: true</code> will not fail if <code>continue-on-error</code> is <code>true</code>. The opposite also stands: a matrix with <code>fail-fast: false</code> will fail if <code>continue-on-error: false</code> is set.</p>\n<p>Reminder: <code>continue-on-error</code> can be used at the step level to prevent a job from failing should that step fail. It can also be used independently of matrices.</p>\n<p>If used alone, <code>continue-on-error</code> might at best cancel out <code>fail-fast</code>, which is not a big advantage. The real leverage comes when `matrix.experimental is added to the mix.</p>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"matrixexperimental\"><code>matrix.experimental</code><a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#matrixexperimental\" class=\"hash-link\" aria-label=\"Direct link to matrixexperimental\" title=\"Direct link to matrixexperimental\">​</a></h4>\n<p><code>matrix-experimental</code> allows matrix jobs to have different <code>continue-on-error</code> values. This way, you can granularly define which failing jobs should or shouldn't halt ongoing &amp; queued jobs.</p>\n<p>An example: you are evaluating a new unstable Node.js version and you want to observe it for a while before release. You don't want the whole matrix to fail if your little experiment fails the tests; it should only fail if stable versions raise issues.<br>\n<!-- -->To exclude that one job, you can <code>include</code> the new version to the matrix and setting that job as the only one with an experimental value of <code>true</code>:</p>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show code</p></summary><div><div class=\"collapsibleContent_i85q\"><div><div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">.github/workflows/testing.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv codeBlockLinesWithNumbering_o6Pm\"><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token key atrule\" style=\"color:#00a4db\">jobs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">unit-tests</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">strategy</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># ommited fail-fast as it's true by default</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">continue-on-error</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> matrix.experimental </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"> </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># dynamically set for each job</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">18</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">20</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">experimental</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token boolean important\" style=\"color:#36acaa\">false</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"> </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># will populate continue-on-error with false</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">include</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">          </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">node-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">21</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line theme-code-block-highlighted-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">            </span><span class=\"token key atrule\" style=\"color:#00a4db\">experimental</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean important\" style=\"color:#36acaa\">true</span><span class=\"token plain\"> </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># will populate continue-on-error with true, but only for the job running Node v21.</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span></span><br></span><span class=\"token-line codeLine_lJS_\" style=\"color:#393A34\"><span class=\"codeLineNumber_Tfdd\"></span><span class=\"codeLineContent_feaV\"><span class=\"token plain\">      (</span><span class=\"token punctuation\" style=\"color:#393A34\">...</span><span class=\"token plain\">)</span></span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div><p>So the resulting jobs from this matrix will be:</p><ul>\n<li>node 18, continue-on-error: false</li>\n<li>node 20, continue-on-error: false</li>\n<li>node 21, continue-on-error: true</li>\n</ul></div></div></div></details>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"dynamically-generated-matrices-handling-empty-matrix-error\">Dynamically-generated matrices: Handling Empty Matrix Error<a href=\"https://magmanu.github.io/blog/tech/matrices-github-actions#dynamically-generated-matrices-handling-empty-matrix-error\" class=\"hash-link\" aria-label=\"Direct link to Dynamically-generated matrices: Handling Empty Matrix Error\" title=\"Direct link to Dynamically-generated matrices: Handling Empty Matrix Error\">​</a></h3>\n<p><em>(This section will make more sense once I add the section about dynamically-generated matrices)</em><br>\n<!-- -->If you are using dynamically generated matrices, your workflow may fail if the matrix ends up spinning an empty result:</p>\n<div class=\"codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-text codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">Error when evaluating 'strategy' for job 'xxxxx'. .github/workflows/my_worflow.yaml (Line: X, Col: Y): Matrix must define at least one vector</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>The fix is to execute the dependent job with a conditional:</p>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token key atrule\" style=\"color:#00a4db\">apply</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">'${{ matrix.account }}'</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">needs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> generate</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">if</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> fromJson(needs.generate.outputs.matrix).include</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token number\" style=\"color:#36acaa\">0</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">strategy</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">fail-fast</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean important\" style=\"color:#36acaa\">false</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">matrix</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">include</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> fromJSON(needs.generate.outputs.matrix) </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>What is happening here?</p>\n<p>The conditional converts the JSON string to an object, and checks if the <code>include</code> key has at least one map. Use fearlessly, because matrices contain the <code>includes</code> property whenever a  matrix has any elements - it doesn't depend on using he <code>include</code> keyword explicitly on the matrix definition.</p>\n<p>##&nbsp;WIP Sections</p>\n<p>Come back later! I've started drafting content for the following sections:</p>\n<ul>\n<li>Limitations (e.g. Matrix outputs don't work neatly, they require artifacts)</li>\n<li>Dynamically-generated Matrices</li>\n<li>Resource Management: Max Number of Concurrent Jobs</li>\n<li>Advanced use of matrices with reusable workflows</li>\n<li>Sharing a matrix between jobs</li>\n</ul>",
            "url": "https://magmanu.github.io/blog/tech/matrices-github-actions",
            "title": "An Ultimate Guide to Matrices in GitHub Actions, from Basic to Advanced",
            "summary": "Listen, I feel the boldest of girls for calling this *an* ultimate guide. But it's just because this will be the one post about matrices I'll update over time as I experience more. All info in a single place for easier retrieval, enjoy!",
            "date_modified": "2025-03-28T00:00:00.000Z",
            "author": {
                "name": "Manu Magalhães",
                "url": "https://github.com/magmanu"
            },
            "tags": [
                "github actions",
                "ci/cd",
                "devops"
            ]
        },
        {
            "id": "https://magmanu.github.io/blog/tech/github-actions-data-flow",
            "content_html": "<p>In Github Actions, by default, data is not inherently persistent or available to the whole pipeline. Every step has is its own process, every job has its own runner. By default, whatever data emerges in a job, ends with it.</p>\n<p>How do we pass data from one process to the other, or save it for the next process?</p>\n<p>A short sweet answer:</p>\n<table><thead><tr><th>Strategy</th><th>Data</th><th>Scope</th><th>Persistence</th><th>Explanation</th><th>Example</th></tr></thead><tbody><tr><td><code>env</code></td><td>Values</td><td>Job (internal)</td><td>Ephemeral</td><td>Propagates <em>data</em> <br> between <em>steps</em> <br>  in the same <em>job</em></td><td>Pass a boolean to control whether the next step should run</td></tr><tr><td><code>outputs</code></td><td>Values</td><td>Workflow (internal)</td><td>Ephemeral</td><td>Propagates <em>data</em> <br> between <em>jobs/steps</em> <br>  in the same <em>workflow</em></td><td>Pass a deployment id to the next job</td></tr><tr><td>artefacts</td><td>Files</td><td>Workflow (internal &amp; external)</td><td>Persistent</td><td>Propagates <em>files</em> <br> between <em>jobs/workflows</em></td><td>Pass the project build to different test jobs running in parallel  <br><br> <em>Intended for frequently changing data. Files are available for download after the workflow finishes.</em></td></tr><tr><td>cache</td><td>Files</td><td>Workflow (internal &amp; external)</td><td>Persistent</td><td>Propagates <em>files</em> <br> inside and between <em>workflows</em> <br>  in the same <em>repository</em></td><td>Cache npm packages for use in different workflow runs. <br><br> <em>Intended for files that don't change much.</em></td></tr></tbody></table>\n<p>For a completer answer: read on.<br>\n<!-- -->All the workflow examples in this article <a href=\"https://github.com/magmanu/blog/tree/main/demos/github-actions-data-flow\" target=\"_blank\" rel=\"noopener noreferrer\">can be found as files here</a>, along with a copy of the respective redacted logs.</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"using-env\">Using <code>env</code><a href=\"https://magmanu.github.io/blog/tech/github-actions-data-flow#using-env\" class=\"hash-link\" aria-label=\"Direct link to using-env\" title=\"Direct link to using-env\">​</a></h2>\n<p>It's pretty simple to create a data flow between steps: define a key-value pair and write it to the <code>GITHUB_ENV</code> environment file, using the appropriate syntax for your shell. See examples below in bash and python:</p>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show code</p></summary><div><div class=\"collapsibleContent_i85q\"><div><div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">/.github/workflows/using_env.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Two ways to set environment variable with sh</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># Warning: in this step, the input is not sanitized or validated</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">shell</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> bash</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          # No print to the logs.</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          random_wiki_article_1=$(curl -L -X GET \"https://en.wikipedia.org/api/rest_v1/page/random/summary\" | jq .title)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"$random_wiki_article_1\"</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"ARTICLE_1=$random_wiki_article_1\" &gt;&gt; \"$GITHUB_ENV\"</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          # 🐉 Print the variable in the logs: only for non-senstive data!</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          random_wiki_article_2=$(curl -L -X GET \"https://en.wikipedia.org/api/rest_v1/page/random/summary\" | jq .title)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"ARTICLE_2=$random_wiki_article_2\" | tee -a \"$GITHUB_ENV\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Set environment variable with python</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">shell</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> python</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># if using \"write\", use \\n when creating multiple vars</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># with \"print\", you can omit \\n</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          from os import environ as env</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          with open(env.get('GITHUB_ENV', None), 'a') as ghenv:</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">            ghenv.write(\"SUBJECT=Sun\\n\")</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">            print(\"STATE=radiant\", file=ghenv)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">            print(\"TIME=today\", file=ghenv)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> 🛡️ Retrieving values securely</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># observe that ARTICLE_1 was not sanitized or validated, so it's vulnerable to injection attacks.</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># The approach below prevents the issue by setting env.ARTICLE_1 as an argument to the script.</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># It also gives you the chance to rename the variables</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">env</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">WHO</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> env.SUBJECT </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">WHAT</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> env.ARTICLE_1 </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">WHEN</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> env.TIME </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"$WHO read about $WHAT $WHEN.\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> 🐉 Retrieving values in a potentially vulnerable way</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># This approach is vulnerable to injection attacks!</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># Only use it if you have control over the input</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">shell</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> bash</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"${{ env.SUBJECT }} is ${{ env.STATE }} ${{ env.TIME }}.\"</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div></div></div></div></details>\n<h4 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"debugging-tip\">Debugging tip<a href=\"https://magmanu.github.io/blog/tech/github-actions-data-flow#debugging-tip\" class=\"hash-link\" aria-label=\"Direct link to Debugging tip\" title=\"Direct link to Debugging tip\">​</a></h4>\n<p>To list all the environment variables available in a job, add this tiny step:</p>\n<p><code>- run: env</code></p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"using-outputs\">Using <code>outputs</code><a href=\"https://magmanu.github.io/blog/tech/github-actions-data-flow#using-outputs\" class=\"hash-link\" aria-label=\"Direct link to using-outputs\" title=\"Direct link to using-outputs\">​</a></h2>\n<p>Outputs are available to all steps in the same job, and to any subsequent job that <code>needs</code> it.<br>\n<!-- -->The output is always an unicode <strong>string</strong>.</p>\n<p>And obviously, jobs that depend on an <code>output</code> will not run in parallel with the job that produces the output.</p>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show code</p></summary><div><div class=\"collapsibleContent_i85q\"><div><p>For simplicity, I show how to set the output in bash, but you can use any shell of your choice.</p><div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">/.github/workflows/outputs-for-different-job.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token key atrule\" style=\"color:#00a4db\">jobs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">setting-outputs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">outputs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\">  </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># Required: name the output in the job level so it's available to other jobs</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">person_name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> steps.use</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">hardcoded</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">value.outputs.NAME </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">location</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> steps.use</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">dynamic</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">value.outputs.LOCATION </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">id</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> use</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">hardcoded</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">value</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"NAME=Marcela\" &gt;&gt; \"$GITHUB_OUTPUT\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">id</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> use</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">dynamic</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">value</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># note the use of jq -c to get the value as a single line</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          location=$(curl -H \"Accept: application/json\" https://randomuser.me/api/ | jq -c .results[].location)</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"LOCATION=$location\" &gt; \"$GITHUB_OUTPUT\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">retrieving-outputs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">needs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> setting</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">outputs</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Greet to location</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          COUNTRY=$(echo $GEODATA | jq -r . | jq .country)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"Hello $NAME, welcome to $COUNTRY!\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">env</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">NAME</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">needs.setting</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">outputs.outputs.person_name</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">GEODATA</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> needs.setting</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">outputs.outputs.location </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div></div></div></div></details>\n<p>Even though it's recommended to use <code>env</code> to pass data between steps, <code>outputs</code> can be used for that purpose as well. This is useful when a value is required both in the current job and in subsequent jobs.</p>\n<details class=\"details_lb9f alert alert--info details_b_Ee\" data-collapsed=\"true\"><summary><p>Show code</p></summary><div><div class=\"collapsibleContent_i85q\"><div><p>The previous example showed how to use outputs in different jobs.<br>\n<!-- -->To use an output the same job, simply add the code in the highlighted section.</p><div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">/.github/workflows/outputs-for-same-job.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token key atrule\" style=\"color:#00a4db\">jobs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">extract</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">outputs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">person_name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> steps.generate</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">hardcoded</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">value.outputs.name </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token key atrule\" style=\"color:#00a4db\">location</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> steps.enerate</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">dynamic</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">value.outputs.location </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">id</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> generate</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">hardcoded</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">value</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"NAME=Marcela\" &gt;&gt; \"$GITHUB_OUTPUT\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">id</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> generate</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">dynamic</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">value</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          location=$(curl -H \"Accept: application/json\" https://randomuser.me/api/ | jq .results[].location | jq @json) </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"LOCATION=$location\" &gt;&gt; \"$GITHUB_OUTPUT\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Consume output in same job</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"$PERSON, you're in $GEODATA, so we've updated your timezone to GMT$OFFSET.\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">env</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">PERSON</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> steps.use</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">hardcoded</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">value.outputs.NAME </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># use fromJSON() when filtering the output value at the env level</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># See more about object filtering in </span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># https://docs.github.com/en/actions/learn-github-actions/expressions#object-filters</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">GEODATA</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> fromJSON(steps.use</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">dynamic</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">value.outputs.LOCATION).country </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">OFFSET</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> fromJSON(steps.use</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">dynamic</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">value.outputs.LOCATION).timezone.offset </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    (</span><span class=\"token punctuation\" style=\"color:#393A34\">...</span><span class=\"token plain\">)</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div></div></div></div></details>\n<div class=\"theme-admonition theme-admonition-info admonition_xJq3 alert alert--info\"><div class=\"admonitionHeading_Gvgb\"><span class=\"admonitionIcon_Rf37\"><svg viewBox=\"0 0 14 16\"><path fill-rule=\"evenodd\" d=\"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z\"></path></svg></span>Helpful debugging info</div><div class=\"admonitionContent_BuS1\"><ul>\n<li>An individual output should be 1MB max.</li>\n<li>All outputs combined should not exceed 50MB.</li>\n</ul></div></div>\n<br>\n<div class=\"theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success\"><div class=\"admonitionHeading_Gvgb\"><span class=\"admonitionIcon_Rf37\"><svg viewBox=\"0 0 12 16\"><path fill-rule=\"evenodd\" d=\"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z\"></path></svg></span>Real life XP</div><div class=\"admonitionContent_BuS1\"><p><code>GITHUB_OUTPUT</code> expects a one-line string.<br>\n<!-- -->If you need a multiline output, assign it to a variable and write to the output as follows:</p><div class=\"language-bash codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-bash codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token builtin class-name\">echo</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"PAYLOAD_NAME&lt;&lt;EOF\"</span><span class=\"token string\" style=\"color:#e3116c\">$'</span><span class=\"token string entity\" style=\"color:#36acaa\">\\n</span><span class=\"token string\" style=\"color:#e3116c\">'</span><span class=\"token plain\">\"</span><span class=\"token variable\" style=\"color:#36acaa\">$payload_var</span><span class=\"token string\" style=\"color:#e3116c\">\"$'</span><span class=\"token string entity\" style=\"color:#36acaa\">\\n</span><span class=\"token string\" style=\"color:#e3116c\">'EOF &gt;&gt; \"</span><span class=\"token variable\" style=\"color:#36acaa\">$GITHUB_OUTPUT</span><span class=\"token plain\">\".</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div></div></div>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"using-artefacts\">Using artefacts<a href=\"https://magmanu.github.io/blog/tech/github-actions-data-flow#using-artefacts\" class=\"hash-link\" aria-label=\"Direct link to Using artefacts\" title=\"Direct link to Using artefacts\">​</a></h2>\n<p>From the docs: \"<em>Use artefacts when you want to save files produced by a job to view after a workflow run has ended, such as built binaries or build logs</em>.\"</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"uploading-artefacts\">Uploading artefacts<a href=\"https://magmanu.github.io/blog/tech/github-actions-data-flow#uploading-artefacts\" class=\"hash-link\" aria-label=\"Direct link to Uploading artefacts\" title=\"Direct link to Uploading artefacts\">​</a></h3>\n<p>You can:</p>\n<ul>\n<li>select one or multiple files to be bundled as an artifact.</li>\n<li>use wildcards, multiple paths and exclusion patterns in the usual GitHub Actions syntax.</li>\n<li>set a retention period for the artefact.</li>\n</ul>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">/.github/workflows/handle-artefacts.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token key atrule\" style=\"color:#00a4db\">jobs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">upload</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Checkout</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">uses</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> actions/checkout@v4</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Upload log files</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">uses</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> actions/upload</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">artifact@v4</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">with</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> all</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">logs      </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># artefact name</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">path</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token plain\">             </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># path to files to be included in the artifact.</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token important\">**/log*.txt</span><span class=\"token plain\">       </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># relative paths are rooted against $GITHUB_WORKSPACE</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">retention-days</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">1</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">if-no-files-found</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> error </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># force step to fail if the content for the artefact is not found</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Note that maximum retention period <a href=\"https://docs.github.com/en/actions/learn-github-actions/usage-limits-billing-and-administration#artifact-and-log-retention-policy\" target=\"_blank\" rel=\"noopener noreferrer\">can be defined at repo, organisation, or enterprise level</a>. There's a max of 90 days for public repos and 400 days for private repos. If you lower the retention period, you'll have more non-billed space ;)</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"downloading-artefacts\">Downloading artefacts<a href=\"https://magmanu.github.io/blog/tech/github-actions-data-flow#downloading-artefacts\" class=\"hash-link\" aria-label=\"Direct link to Downloading artefacts\" title=\"Direct link to Downloading artefacts\">​</a></h3>\n<p>To retrieve the artefact, you can use:</p>\n<ul>\n<li>the <a href=\"https://docs.github.com/en/actions/managing-workflow-runs/downloading-workflow-artifacts\" target=\"_blank\" rel=\"noopener noreferrer\">Github UI</a></li>\n<li>the <a href=\"https://docs.github.com/en/rest/actions/artifacts?apiVersion=2022-11-28#download-an-artifact\" target=\"_blank\" rel=\"noopener noreferrer\">Github API</a></li>\n<li>the <a href=\"https://docs.github.com/en/actions/managing-workflow-runs/downloading-workflow-artifacts?tool=cli\" target=\"_blank\" rel=\"noopener noreferrer\"><code>gh</code> cli</a></li>\n<li>the official <a href=\"https://github.com/marketplace/actions/download-a-build-artifact\" target=\"_blank\" rel=\"noopener noreferrer\"><code>actions/download-artifact</code></a> action, if you need to retrieve artifacts programmatically. From <code>v4</code>, the action allows you to download artefacts from a different workflows or repos, as long as you provide a token. (🛡️: it's recommended to use a GitHub App rather than a PAT for professional projects.)</li>\n</ul>\n<p>Let's see how to retrieve the artefact we created in the previous example using <code>actions/download-artifact</code>:</p>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">/.github/workflows/handle-artefacts.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token key atrule\" style=\"color:#00a4db\">download</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">needs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> upload</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Download log files</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">id</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> download</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">artifacts</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">uses</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> actions/download</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">artifact@v4</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">with</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> all</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">logs  </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># note it uses the name defined in the upload step</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Pass artifact path to python</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">shell</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> python</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          import os</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          from glob import glob</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          artifact_path = os.environ.get(\"ARTIFACT_PATH\", \"\")</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          glob_list = glob(artifact_path + \"/*.txt\")</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          for filename in glob_list:</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">              with open(filename, \"r\", encoding=\"UTF-8\") as f:</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">                  content = f.read()</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">                  print(content)</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">env</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">ARTIFACT_PATH</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> steps.download</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">artifacts.outputs.download</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">path </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>All the zipping and unzipping of the artifacts is automatically handled by the actions.</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"deleting-artefacts\">Deleting artefacts<a href=\"https://magmanu.github.io/blog/tech/github-actions-data-flow#deleting-artefacts\" class=\"hash-link\" aria-label=\"Direct link to Deleting artefacts\" title=\"Direct link to Deleting artefacts\">​</a></h3>\n<p>To delete an artefact, you can:</p>\n<ul>\n<li>use the <a href=\"https://docs.github.com/en/actions/managing-workflow-runs/removing-workflow-artifacts\" target=\"_blank\" rel=\"noopener noreferrer\">Github UI</a></li>\n<li>use the <a href=\"https://docs.github.com/en/rest/reference/actions#delete-an-artifact\" target=\"_blank\" rel=\"noopener noreferrer\">Github API</a></li>\n<li>write a <a href=\"https://gist.github.com/qwe321qwe321qwe321/efae4569576006624c34f23b2dd76a58\" target=\"_blank\" rel=\"noopener noreferrer\">custom script using the Github API</a> or using a <a href=\"https://github.com/GeekyEggo/delete-artifact\" target=\"_blank\" rel=\"noopener noreferrer\">community action</a>.</li>\n</ul>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"using-cache\">Using cache<a href=\"https://magmanu.github.io/blog/tech/github-actions-data-flow#using-cache\" class=\"hash-link\" aria-label=\"Direct link to Using cache\" title=\"Direct link to Using cache\">​</a></h2>\n<div class=\"theme-admonition theme-admonition-danger admonition_xJq3 alert alert--danger\"><div class=\"admonitionHeading_Gvgb\"><span class=\"admonitionIcon_Rf37\"><svg viewBox=\"0 0 12 16\"><path fill-rule=\"evenodd\" d=\"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z\"></path></svg></span>🐉 Security warning</div><div class=\"admonitionContent_BuS1\"><p>Do not store sensitive information in the cache (beware of configuration files containing secrets), as the cache is accessible to anyone who can create a PR on the repository, even on forks.</p></div></div>\n<p>When we're handling data that is pretty stable and repeatedly used (like dependencies), we can do better than re-generating them every time: we can cache them for better performance.</p>\n<p>In the example below, we're caching the <code>pip</code> dependencies for a Python project. Note that we have added the cache step before the pip install step. The idea is that the install will only happen if the cache is not good or available:</p>\n<div class=\"language-yaml codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">/.github/workflows/cache.yaml</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-yaml codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token key atrule\" style=\"color:#00a4db\">jobs</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token key atrule\" style=\"color:#00a4db\">cache</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">runs-on</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> ubuntu</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">latest</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token key atrule\" style=\"color:#00a4db\">steps</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">uses</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> actions/checkout@v4</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">uses</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> actions/setup</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">python@v5</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">with</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">python-version</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">'3.12'</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">cache</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">'pip'</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">cache-dependency-path</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">            **/requirements.txt</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Get pip cache dir</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">id</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> pip</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">cache</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">|</span><span class=\"token scalar string\" style=\"color:#e3116c\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token scalar string\" style=\"color:#e3116c\">          echo \"dir=$(pip cache dir)\" &gt;&gt; $GITHUB_OUTPUT</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Handle cache for Python dependencies</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">uses</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> actions/cache@v3</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        The cache action requires a `path` to the cache and a `key`. The `key` is used to retrieve the cache and to recreate it next time. </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">id</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> cache</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">with</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># path: location of files to cache</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">path</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> steps.pip</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">cache.outputs.dir </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"> </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># key: unique id used to retrieve and recreate the cache</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token key atrule\" style=\"color:#00a4db\">key</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> runner.os </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">pip</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">$</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> hashFiles('</span><span class=\"token important\">**/requirements.txt')</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"> </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\"> </span><span class=\"token key atrule\" style=\"color:#00a4db\">name</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Install dependencies if not found in cache</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">if</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> steps.cache.outputs.cache</span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">hit </span><span class=\"token tag\" style=\"color:#00009f\">!=</span><span class=\"token plain\"> 'true'</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token key atrule\" style=\"color:#00a4db\">run</span><span class=\"token punctuation\" style=\"color:#393A34\">:</span><span class=\"token plain\"> pip install </span><span class=\"token punctuation\" style=\"color:#393A34\">-</span><span class=\"token plain\">r requirements.txt</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"setting-the-cache\">Setting the cache<a href=\"https://magmanu.github.io/blog/tech/github-actions-data-flow#setting-the-cache\" class=\"hash-link\" aria-label=\"Direct link to Setting the cache\" title=\"Direct link to Setting the cache\">​</a></h3>\n<p>The first time the workflow runs, the cache is obviously empty. Therefore, the output <code>cache-hit</code> (native to the official <code>actions/cache</code> action), will return <code>false</code>, which in turn makes our workflow run the install step.<br>\n<a href=\"https://raw.githubusercontent.com/magmanu/blog/main/demos/github-actions-data-flow/31_data_flow_cache_set-cache.txt\" target=\"_blank\" rel=\"noopener noreferrer\"><em>Check logs</em></a></p>\n<p>However, a small magic happens too: a post-cache step, automatically added by <code>action/cache</code> at the end of the job, will look at the keys your provided and add the files to the cache.</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"retrieving-the-cache\">Retrieving the cache<a href=\"https://magmanu.github.io/blog/tech/github-actions-data-flow#retrieving-the-cache\" class=\"hash-link\" aria-label=\"Direct link to Retrieving the cache\" title=\"Direct link to Retrieving the cache\">​</a></h3>\n<p>As long as nothing has changed in your dependency manifest, the next time <code>actions/cache</code> runs for that path and key, the action will find a <code>cache-hit</code>and the workflow will safely skip the install step.<br>\n<a href=\"https://raw.githubusercontent.com/magmanu/blog/main/demos/github-actions-data-flow/32_data_flow_cache_use-cache.txt\" target=\"_blank\" rel=\"noopener noreferrer\"><em>Check logs</em></a></p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"updating-the-cache\">Updating the cache<a href=\"https://magmanu.github.io/blog/tech/github-actions-data-flow#updating-the-cache\" class=\"hash-link\" aria-label=\"Direct link to Updating the cache\" title=\"Direct link to Updating the cache\">​</a></h3>\n<p>Have you noted the <code>hashFiles</code> function used in the <code>key</code> argument?<br>\n<!-- -->This is a function provided by GitHub Actions that creates a unique hash value based on a file path. When the hash value doesn't match, it means that there was a change in the file - in our case, the dependency manifest.</p>\n<p>If the dependencies changed (even a single patch), the cache is no good anymore and the <code>cache-hit</code> output will allow <code>pip install</code> to run. And then we're back to square one: dependencies are installed and the cache is updated on a post-cache job.<br>\n<a href=\"https://raw.githubusercontent.com/magmanu/blog/main/demos/github-actions-data-flow/33_data_flow_cache_update-cache.txt\" target=\"_blank\" rel=\"noopener noreferrer\"><em>Check the logs</em></a></p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"last-notes-about-caching\">Last notes about caching<a href=\"https://magmanu.github.io/blog/tech/github-actions-data-flow#last-notes-about-caching\" class=\"hash-link\" aria-label=\"Direct link to Last notes about caching\" title=\"Direct link to Last notes about caching\">​</a></h3>\n<ul>\n<li>If you’re using self-hosted runners, the option to self-store the cache is only available in Enterprise plans.</li>\n<li>This action <code>actions/cache</code> manages the cache centrally. This means that the cache is available to (and updatable by) all jobs in the same repository - and even to other workflows.</li>\n<li>Read more about <a href=\"https://github.com/actions/cache/blob/main/caching-strategies.md\" target=\"_blank\" rel=\"noopener noreferrer\">caching strategies here</a>.</li>\n</ul>\n<p>That was a long post, phew.<br>\n<!-- -->See you later!  :)</p>",
            "url": "https://magmanu.github.io/blog/tech/github-actions-data-flow",
            "title": "GitHub Actions: Data Flow & Data Persistence",
            "summary": "In Github Actions, by default, data is not inherently persistent or available to the whole pipeline. Every step has is its own process, every job has its own runner. By default, whatever data emerges in a job, ends with it.",
            "date_modified": "2023-10-31T00:00:00.000Z",
            "author": {
                "name": "Manu Magalhães",
                "url": "https://github.com/magmanu"
            },
            "tags": [
                "github actions",
                "ci/cd",
                "pipeline",
                "env",
                "outputs",
                "artefacts",
                "cache"
            ]
        },
        {
            "id": "https://magmanu.github.io/blog/tech/dynamic-json-in-terraform",
            "content_html": "<p>In this article I’ll use Step Functions as a case study, but you can do it with whatever resources you want.</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"what-were-going-to-do\">What we’re going to do<a href=\"https://magmanu.github.io/blog/tech/dynamic-json-in-terraform#what-were-going-to-do\" class=\"hash-link\" aria-label=\"Direct link to What we’re going to do\" title=\"Direct link to What we’re going to do\">​</a></h2>\n<p>The following JSON will become dynamic. We’ll replace static values with:</p>\n<ol>\n<li><a href=\"https://magmanu.github.io/blog/tech/dynamic-json-in-terraform#case-1-injecting-a-variable-into-json\">A variable</a></li>\n<li><a href=\"https://magmanu.github.io/blog/tech/dynamic-json-in-terraform#case-2-injecting-a-list-into-a-json\">A dynamic list</a></li>\n<li><a href=\"https://magmanu.github.io/blog/tech/dynamic-json-in-terraform#case-3-injecting-an-object-into-a-json\">One or more dynamic objects</a></li>\n</ol>\n<p>(I’ve added non idiomatic comments inside the code blocks, but it’s just to show what exactly we’re doing.)</p>\n<div class=\"language-json codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">Reference json</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-json codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Comment\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"My state machine\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"StartAt\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Choice\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"States\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Handle Notification\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::lambda:invoke\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"OutputPath\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.Payload\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token property\" style=\"color:#36acaa\">\"Payload.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              -----&gt; Case </span><span class=\"token number\" style=\"color:#36acaa\">1</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Replace with dynamic string</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token property\" style=\"color:#36acaa\">\"FunctionName\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"my_function_name\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"End\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Choice\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Choice\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          ----&gt; Case </span><span class=\"token number\" style=\"color:#36acaa\">2</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Replace with dynamic list</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"Choices\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">             </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">                 </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">               </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                      </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">               </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM Execution-InstanceId\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">     </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">               </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.InstanceId\"</span><span class=\"token plain\">              </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">               </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">                </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">               </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                      </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">               </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM Execution-SecurityGroupIds\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">               </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.SecurityGroupIds\"</span><span class=\"token plain\">        </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">                </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Default\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        ----&gt; Case </span><span class=\"token number\" style=\"color:#36acaa\">3</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> Replace with one or more dynamic objects</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"SSM Execution-InstanceId\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token property\" style=\"color:#36acaa\">\"DocumentName.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.DocumentName\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token property\" style=\"color:#36acaa\">\"InstanceId.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.InstanceId)\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::aws-sdk:ssm:startAutomationExecution\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"ResultPath\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.TaskResult\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token plain\"> </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"SSM Execution-SecurityGroupIds\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token property\" style=\"color:#36acaa\">\"DocumentName.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.DocumentName\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token property\" style=\"color:#36acaa\">\"SecurityGroupIds.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.SecurityGroupIds)\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::aws-sdk:ssm:startAutomationExecution\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"ResultPath\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.TaskResult\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token plain\"> </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Pass\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"End\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>First, save the JSON above in a template format. You can use the extension <code>.tpl</code> or <code>.tftpl</code>. Although Terraform recommends using the second option, there's no hard rule about which to use.</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"case-1-injecting-a-variable-into-json\">Case 1: Injecting a variable into JSON<a href=\"https://magmanu.github.io/blog/tech/dynamic-json-in-terraform#case-1-injecting-a-variable-into-json\" class=\"hash-link\" aria-label=\"Direct link to Case 1: Injecting a variable into JSON\" title=\"Direct link to Case 1: Injecting a variable into JSON\">​</a></h2>\n<p>Let’s begin by updating the <code>FunctionName</code> value in the template, using string interpolation:</p>\n<div class=\"language-json codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/templates/stepfunction_definition.tftpl (extract)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-json codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"Handle Notification\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::lambda:invoke\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"OutputPath\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.Payload\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"Payload.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"FunctionName\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"${lambda_function_name}\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"End\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>To render the template as a valid JSON, we can use Terraform’s <code>templatefile</code> function. It takes two arguments: the template file path and a map of variables that will be injected at runtime. For the sake of the argument, let’s keep our new module as dynamic as possible. Locals, variables and resources are also included just to show how things work together.</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/stepfunction.tf (full file)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">locals</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">file</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> templatefile(</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation keyword\" style=\"color:#00009f\">path</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation type variable\" style=\"color:#36acaa\">module</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">/templates/stepfunction_definition.tpl\"</span><span class=\"token plain\">, </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">lambda_function_name</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.lambda_function_name</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">variable</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"lambda_function_name\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">description</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Lambda function name\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">type</span><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> string</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">resource </span><span class=\"token keyword type variable\" style=\"color:#36acaa\">\"aws_sfn_state_machine\"</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"sfn_state_machine\"</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">name</span><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.step_function_name</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">role_arn</span><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.sf_role_arn</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">definition</span><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> local.file</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Now we write a top level <code>main.tf</code>, where the actual values go.</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">main.tf (full file)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">module</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"my_step_function\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token property\" style=\"color:#36acaa\">source</span><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"./modules/step_functions\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token property\" style=\"color:#36acaa\">step_function_name</span><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"autoremediation_sf\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token property\" style=\"color:#36acaa\">sf_role_arn</span><span class=\"token plain\">           </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:iam::123456789012:role/autoremediation_sf\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token property\" style=\"color:#36acaa\">lambda_function_name</span><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"autoremediation_lambda\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>To check that your variable was successfully injected, run <code>terraform init &amp;&amp; terraform plan</code>.</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"case-2-injecting-a-list-into-a-json\">Case 2: Injecting a list into a JSON<a href=\"https://magmanu.github.io/blog/tech/dynamic-json-in-terraform#case-2-injecting-a-list-into-a-json\" class=\"hash-link\" aria-label=\"Direct link to Case 2: Injecting a list into a JSON\" title=\"Direct link to Case 2: Injecting a list into a JSON\">​</a></h2>\n<p>As a refresher, we will abstract this whole list:</p>\n<div class=\"language-json codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/templates/stepfunction_definition.tftpl (extract)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-json codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token property\" style=\"color:#36acaa\">\"Choice\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Choice\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Choices\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">                             </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">                 </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                      </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM Execution-InstanceId\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">     </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.InstanceId\"</span><span class=\"token plain\">              </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                      </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM Execution-SecurityGroupIds\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"> |</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">          </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.SecurityGroupIds\"</span><span class=\"token plain\">        </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">                 </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">                                       </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Default\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>So let’s refactor the template again. We’ll use a Terraform function called <code>jsonencode</code>, as it ensures that the list of objects we’re passing to the template will be properly rendered as JSON:</p>\n<div class=\"language-json codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/templates/stepfunction_definition.tftpl (extract)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-json codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token property\" style=\"color:#36acaa\">\"Choice\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Choice\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Choices\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">jsonencode(choices_list)</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Default\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Now, we’ll try two ways to feed the template with our dynamic list.</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"the-simplest-solution-static-list\">The simplest solution: static list<a href=\"https://magmanu.github.io/blog/tech/dynamic-json-in-terraform#the-simplest-solution-static-list\" class=\"hash-link\" aria-label=\"Direct link to The simplest solution: static list\" title=\"Direct link to The simplest solution: static list\">​</a></h3>\n<p>One option is to create a variable that will pass a ready-made list for you:</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/stepfunction.tf (extract)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">locals</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">file</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> templatefile(</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation keyword\" style=\"color:#00009f\">path</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation type variable\" style=\"color:#36acaa\">module</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">/templates/stepfunction_definition.tpl\"</span><span class=\"token plain\">, </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">lambda_function_name</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.lambda_function_name</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">choices_list</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.my_list</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">variable</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"my_list\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">description</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"A list of whatever\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">type</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> list</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Then, in top level module, pass the variable values. The JSON is now dynamic, but the list is pretty much “static”.</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">main.tf (full file)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">module</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"my_step_function\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">source</span><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"./modules/step_functions\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">step_function_name</span><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"autoremediation_sf\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">sf_role_arn</span><span class=\"token plain\">           </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:iam::123456789012:role/autoremediation_sf\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">lambda_function_name</span><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"autoremediation_lambda\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">my_list</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token plain\">: </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM Execution-InstanceId\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.InstanceId\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"the-logic-heavy-solution-dynamic-list\">The logic-heavy solution: dynamic list<a href=\"https://magmanu.github.io/blog/tech/dynamic-json-in-terraform#the-logic-heavy-solution-dynamic-list\" class=\"hash-link\" aria-label=\"Direct link to The logic-heavy solution: dynamic list\" title=\"Direct link to The logic-heavy solution: dynamic list\">​</a></h3>\n<p>What if you want the list itself to be dynamic too? For example, you want the values for <code>Next</code> and <code>Variable</code> to be extracted from a parameter and injected to list before it’s sent to the json?\nIn our example, the values that populate <code>Next</code> and <code>Variable</code> come from keys provided by <code>ssm_params</code>, in the top level file:</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">main.tf (extract)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">module</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"my_step_function\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">source</span><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"./modules/step_functions\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">step_function_name</span><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"autoremediation_sf\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">sf_role_arn</span><span class=\"token plain\">           </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:iam::123456789012:role/autoremediation_sf\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">lambda_function_name</span><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"autoremediation_lambda\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\">#  Static list is no longer here</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">ssm_params</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"InstanceId\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.InstanceId)\"</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,    </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"SecurityGroupIds\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.SecurityGroupIds)\"</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Now our module becomes:</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/stepfunction.tf (full file)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">locals</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">choices_list</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> flatten(</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">for item in var.ssm_params: </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        for key, value in item : </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token plain\">: </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM Execution-</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">key</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">key</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\">)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">file</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> templatefile(</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation keyword\" style=\"color:#00009f\">path</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation type variable\" style=\"color:#36acaa\">module</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">/templates/stepfunction_definition.tpl\"</span><span class=\"token plain\">, </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">lambda_function_name</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.lambda_function_name,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">choices_list</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> local.choices_list</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">variable</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"lambda_function_name\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">description</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Lambda function name\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">type</span><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> string</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">variable</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"ssm_params\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">description</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"List of SSM param objects to be injected into the Step Function definition\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">type</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> list</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">resource </span><span class=\"token keyword type variable\" style=\"color:#36acaa\">\"aws_sfn_state_machine\"</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"sfn_state_machine\"</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">name</span><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.step_function_name</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">role_arn</span><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> aws_iam_role.step_function_role_arn</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">definition</span><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> local.file</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Starting with the line <code>choices_list = flatten([for item in var.ssm_params:</code> ignore <code>flatten</code> for a bit and look at the loop. Because <code>ssm_params</code> is a list, we have to loop through it to access each item. The loop is wrapped in square brackets, which means the output will be a list. The <code>:</code> that follows is just part of the loop syntax.</p>\n<p>Next line, another loop: <code>for key, value in item : {</code> . This loop goes through each object in <code>ssm_params</code> to access key and the value, so we can extract and restructure the data. The loop is also wrapped with square brackets, meaning that every object will unfortunately be inside their own list.</p>\n<p>Now, remember <code>flatten</code>? We're using this Terraform function because, as each loop returns a list, the result looks like this: <code>[[obj1],[obj2]]</code>. But we need a clean list of objects, and flatten can get rid of the unnecessary nesting.</p>\n<p>Done.</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"case-3-injecting-an-object-into-a-json\">Case 3: Injecting an object into a JSON<a href=\"https://magmanu.github.io/blog/tech/dynamic-json-in-terraform#case-3-injecting-an-object-into-a-json\" class=\"hash-link\" aria-label=\"Direct link to Case 3: Injecting an object into a JSON\" title=\"Direct link to Case 3: Injecting an object into a JSON\">​</a></h2>\n<p>Now, the most exciting part. We will abstract whole objects. (In this particular case, this means whole steps can become dynamic despite Amazon States Language!)\nYou see all this code below? We're refactoring IT ALL away!</p>\n<div class=\"language-json codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-json codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token property\" style=\"color:#36acaa\">\"Steps\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"SSM Execution-InstanceId\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">            </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token property\" style=\"color:#36acaa\">\"DocumentName.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.DocumentName\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">                    </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token property\" style=\"color:#36acaa\">\"InstanceId.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.InstanceId)\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">           </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::aws-sdk:ssm:startAutomationExecution\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"ResultPath\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.TaskResult\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token plain\"> </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"SSM Execution-SecurityGroupIds\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">        </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token property\" style=\"color:#36acaa\">\"DocumentName.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.DocumentName\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">                    </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token property\" style=\"color:#36acaa\">\"SecurityGroupIds.$\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.SecurityGroupIds)\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">             </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::aws-sdk:ssm:startAutomationExecution\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"ResultPath\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"$.TaskResult\"</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\">          </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token plain\"> </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">                                    </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>As usual, let’s modify the template:</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/templates/stepfunction_definition.tftpl (extract)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token property\" style=\"color:#36acaa\">\"States\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Choice\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Choice\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token property\" style=\"color:#36acaa\">\"Choices\"</span><span class=\"token plain\">: $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">jsonencode(choices)</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token property\" style=\"color:#36acaa\">\"Default\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    %</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> for key, data in ssm_execution </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"${key}\"</span><span class=\"token plain\">: $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">jsonencode(data)</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    %</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> endfor </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Handle Notification\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">&lt;--- blahblah--&gt;</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Here’s where I ask you to trust Terraform even if your linter freaks out.</p>\n<p>What’s happening? We’re using the <a href=\"https://developer.hashicorp.com/terraform/language/expressions/strings#directives\" target=\"_blank\" rel=\"noopener noreferrer\">Terraform directive</a> syntax <code>%{}</code> to write a dynamic string (yeah, templates are treated as strings).</p>\n<p>The line <code>%{ for key, data in ssm_execution }</code> informs the <code>templatefile</code> function that an iteration is coming, and it will end when it reaches the line <code>%{ endfor }</code>. In the meanwhile, it should keep creating a key-value pair with the format <code>\"my_key\": {\"some\": \"json\"},</code>.</p>\n<p>Pretty cool, uh?</p>\n<p>So now let’s add the local <code>ssm_execution</code>, the logic that will populate all this.</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/stepfunction.tf (extract)</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">locals</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">choices</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> flatten(</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">for item in var.ssm_params: </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        for key, value in item : </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token plain\">: </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM Execution-</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">key</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">key</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\">)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">ssm_execution</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> merge(flatten(</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">for item in var.ssm_params: </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"> </span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                    for key, value in item : </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                        </span><span class=\"token property\" style=\"color:#36acaa\">\"SSM Execution-${key}\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                              </span><span class=\"token property\" style=\"color:#36acaa\">\"DocumentName.$\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.DocumentName\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                              </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"$.${key}\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">value</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::aws-sdk:ssm:startAutomationExecution\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Handle Notification\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"ResultPath\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.TaskResult\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">                )...)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">file</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> templatefile(</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation keyword\" style=\"color:#00009f\">path</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation type variable\" style=\"color:#36acaa\">module</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">/templates/stepfunction_definition.tpl\"</span><span class=\"token plain\">, </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">lambda_function_name</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.lambda_function_name,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">choices_list</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> local.choices,</span><br></span><span class=\"token-line theme-code-block-highlighted-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">ssm_execution</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> local.ssm_execution</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>We’re already familiar with loops and flatten, so let’s talk about the new kids on the block: <code>merge</code> and <code>...</code>.</p>\n<p><code>merge</code> is a terraform function that takes multiple objects and merge them together into a single object. So, if we have two objects like</p>\n<div class=\"language-json codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-json codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"a\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">1</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"b\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">2</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"c\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">3</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"d\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">4</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>the <code>merge</code> function will consolidate them to:</p>\n<div class=\"language-json codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-json codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"a\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">1</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"b\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">2</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"c\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">3</span><span class=\"token punctuation\" style=\"color:#393A34\">,</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"d\"</span><span class=\"token operator\" style=\"color:#393A34\">:</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">4</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>And if you were paying attention, you noticed that the merge function in our module is <strong>not</strong> taking several object as arguments, but a flatten function (which outputs a single list). We have <code>...</code> to thank for the trick.\nIn Terraform, <code>...</code> (three dots) work like the Javascript spread operator: it expands our list into separate arguments.\nSo that’s it. Our final template will literally be half the size of our original JSON, it’s dynamic, reusable, and best of all — frees you from ever handling Amazon States Language in your project again.</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"final-files\">Final files<a href=\"https://magmanu.github.io/blog/tech/dynamic-json-in-terraform#final-files\" class=\"hash-link\" aria-label=\"Direct link to Final files\" title=\"Direct link to Final files\">​</a></h2>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/templates/stepfunction_definition.tpl</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"Comment\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"My state machine\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"StartAt\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Choice\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">\"States\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Handle Notification\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::lambda:invoke\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"OutputPath\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.Payload\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token property\" style=\"color:#36acaa\">\"Payload.$\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token property\" style=\"color:#36acaa\">\"FunctionName\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">lambda_function_name</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"End\"</span><span class=\"token plain\">: </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Choice\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Choice\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Choices\"</span><span class=\"token plain\">: $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">jsonencode(choices)</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Default\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        %</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> for key, data in ssm_execution </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"${key}\"</span><span class=\"token plain\">: $</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\">jsonencode(data)</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        %</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> endfor </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Pass\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Pass\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"End\"</span><span class=\"token plain\">: </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">modules/stepfunction.tf</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token keyword\" style=\"color:#00009f\">locals</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">choices</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> flatten(</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">for item in var.ssm_params: </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        for key, value in item : </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token plain\">: </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM Execution-</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">key</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">key</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\">)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">ssm_execution</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> merge(flatten(</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">for item in var.ssm_params: </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"> </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                    for key, value in item : </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                        </span><span class=\"token property\" style=\"color:#36acaa\">\"SSM Execution-${key}\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"Type\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Task\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                              </span><span class=\"token property\" style=\"color:#36acaa\">\"DocumentName.$\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.DocumentName\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                              </span><span class=\"token property\" style=\"color:#36acaa\">\"Parameters\"</span><span class=\"token plain\">: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"$.${key}\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">value</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"Resource\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:states:::aws-sdk:ssm:startAutomationExecution\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"Handle Notification\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                            </span><span class=\"token property\" style=\"color:#36acaa\">\"ResultPath\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.TaskResult\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                        </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                )...)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">file</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> templatefile(</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation keyword\" style=\"color:#00009f\">path</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation type variable\" style=\"color:#36acaa\">module</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">/templates/stepfunction_definition.tpl\"</span><span class=\"token plain\">, </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">lambda_function_name</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.lambda_function_name,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">choices_list</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> local.choices,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">ssm_execution</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> local.ssm_execution</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">variable</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"lambda_function_name\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">description</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Lambda function name\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">type</span><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> string</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">variable</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"ssm_params\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">description</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"List of SSM param objects to be injected into the Step Function definition\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">type</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> list</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">resource </span><span class=\"token keyword type variable\" style=\"color:#36acaa\">\"aws_sfn_state_machine\"</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"sfn_state_machine\"</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">name</span><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.step_function_name</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">role_arn</span><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> var.sf_role_arn</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">definition</span><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> local.file</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockTitle_Ktv7\">main.tf</div><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">module</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"my_step_function\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">source</span><span class=\"token plain\">                </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"./modules/step_functions\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">step_function_name</span><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"autoremediation_sf\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">sf_role_arn</span><span class=\"token plain\">           </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"arn:aws:iam::123456789012:role/autoremediation_sf\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">lambda_function_name</span><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"autoremediation_lambda\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">ssm_params</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">                </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"InstanceId\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.InstanceId)\"</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">,    </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"SecurityGroupIds\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.SecurityGroupIds)\"</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>",
            "url": "https://magmanu.github.io/blog/tech/dynamic-json-in-terraform",
            "title": "Generating Dynamic JSON in Terraform",
            "summary": "In this article I’ll use Step Functions as a case study, but you can do it with whatever resources you want.",
            "date_modified": "2023-03-18T00:00:00.000Z",
            "author": {
                "name": "Manu Magalhães",
                "url": "https://github.com/magmanu"
            },
            "tags": [
                "infra",
                "terraform",
                "IaC",
                "step functions",
                "devops"
            ]
        },
        {
            "id": "https://magmanu.github.io/blog/tech/terraform-ternary-error",
            "content_html": "<p>Have you ever came across this Terraform error — when you intentionally want your ternary to output different types?</p>\n<blockquote>\n<p>The true and false result expressions must have consistent types</p>\n</blockquote>\n<p>To bypass this Terraform limitation, check the tip below. I'll follow it with two examples to clarify the usage:</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token property\" style=\"color:#36acaa\">attribute</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    &lt;desired output if </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\">&gt;, </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    &lt;desired output if </span><span class=\"token boolean\" style=\"color:#36acaa\">false</span><span class=\"token plain\">&gt;</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">&lt;condition&gt; ? </span><span class=\"token number\" style=\"color:#36acaa\">0</span><span class=\"token plain\"> : </span><span class=\"token number\" style=\"color:#36acaa\">1</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"simple-example\">Simple example<a href=\"https://magmanu.github.io/blog/tech/terraform-ternary-error#simple-example\" class=\"hash-link\" aria-label=\"Direct link to Simple example\" title=\"Direct link to Simple example\">​</a></h2>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token keyword\" style=\"color:#00009f\">locals</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">dynamic_value</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"region\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation keyword\" style=\"color:#00009f\">var</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation type variable\" style=\"color:#36acaa\">region</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\">, </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token string\" style=\"color:#e3116c\">\"unavailable\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">var.region </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"eu-west-1\"</span><span class=\"token plain\"> ? </span><span class=\"token number\" style=\"color:#36acaa\">0</span><span class=\"token plain\"> : </span><span class=\"token number\" style=\"color:#36acaa\">1</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Here, <code>local.dynamic_value</code> will return an object if the AWS region is Ireland, or the string <code>\"unavailable\"</code> for any other region.</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"wait-whats-just-happened\">Wait, what's just happened?<a href=\"https://magmanu.github.io/blog/tech/terraform-ternary-error#wait-whats-just-happened\" class=\"hash-link\" aria-label=\"Direct link to Wait, what's just happened?\" title=\"Direct link to Wait, what's just happened?\">​</a></h3>\n<p>Instead of using the ternary in the traditional way, we defined a tuple (aka, a list with mixed types), and used the ternary to return the index for the output we really want. Thanks mariux for the trick.</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"less-simple-example\">Less simple example<a href=\"https://magmanu.github.io/blog/tech/terraform-ternary-error#less-simple-example\" class=\"hash-link\" aria-label=\"Direct link to Less simple example\" title=\"Direct link to Less simple example\">​</a></h2>\n<p>You can also inject dynamic outputs if needs be. I'm not saying this is Terraform best practice, or that it will be pretty. But sometimes a woman has to do what she has to do.</p>\n<p>In my case, I was trying to abstract a Step Function <code>Choice</code>. The ternary logic I needed was: if the object contains only one key, return a certain JSON structure. If the object contains multiple keys, return a different JSON structure.\nAnd this is how my condition panned out:</p>\n<div class=\"language-hcl codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-hcl codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># There is a reason why this variable is a list</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># but that is beside the point now</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">variable</span><span class=\"token keyword type variable\" style=\"color:#36acaa\"> \"ssm_params\" </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">description</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token string\" style=\"color:#e3116c\">\"Parameter required by SSM Documents to enable KMS key rotation\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token property\" style=\"color:#36acaa\">default</span><span class=\"token plain\">     </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token property\" style=\"color:#36acaa\">\"KeyId\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.KeyId)\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">                    </span><span class=\"token property\" style=\"color:#36acaa\">\"AutomationAssumeRole\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"States.Array($.AutomationAssumeRole)\"</span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\" style=\"display:inline-block\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token keyword\" style=\"color:#00009f\">locals</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token property\" style=\"color:#36acaa\">choices</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">for item in var.ssm_params: </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># desired output if true</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    merge(flatten(</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      for key, value in item: </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token plain\">: </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM-</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">key</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">key</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\">)...),</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># desired output if false</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    merge(</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># Case: Choice step has multiple conditions (AND) </span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"> </span><span class=\"token property\" style=\"color:#36acaa\">\"And\"</span><span class=\"token plain\"> : </span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">          for key, value in item: </span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">{</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token property\" style=\"color:#36acaa\">\"IsPresent\"</span><span class=\"token plain\">: </span><span class=\"token boolean\" style=\"color:#36acaa\">true</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">              </span><span class=\"token property\" style=\"color:#36acaa\">\"Variable\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"$.</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation\" style=\"color:#e3116c\">key</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">            </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">        </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\">,</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token property\" style=\"color:#36acaa\">\"Next\"</span><span class=\"token plain\">: </span><span class=\"token string\" style=\"color:#e3116c\">\"SSM-</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">$</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">{</span><span class=\"token string interpolation function\" style=\"color:#d73a49\">join</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">(</span><span class=\"token string interpolation string\" style=\"color:#e3116c\">\"\"</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">,</span><span class=\"token string interpolation\" style=\"color:#e3116c\"> </span><span class=\"token string interpolation function\" style=\"color:#d73a49\">sort</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">(</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">[</span><span class=\"token string interpolation function\" style=\"color:#d73a49\">keys</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">(</span><span class=\"token string interpolation\" style=\"color:#e3116c\">item</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">)</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">]</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">.</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">)</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">)</span><span class=\"token string interpolation punctuation\" style=\"color:#393A34\">}</span><span class=\"token string\" style=\"color:#e3116c\">\"</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\">...)</span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">    </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token comment\" style=\"color:#999988;font-style:italic\"># condition</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      length(flatten(</span><span class=\"token punctuation\" style=\"color:#393A34\">[</span><span class=\"token plain\">keys(item)</span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\">)) </span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token punctuation\" style=\"color:#393A34\">=</span><span class=\"token plain\"> </span><span class=\"token number\" style=\"color:#36acaa\">1</span><span class=\"token plain\"> ? </span><span class=\"token number\" style=\"color:#36acaa\">0</span><span class=\"token plain\"> : </span><span class=\"token number\" style=\"color:#36acaa\">1</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">      </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\">  </span><span class=\"token punctuation\" style=\"color:#393A34\">]</span><span class=\"token plain\"></span><br></span><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token plain\"></span><span class=\"token punctuation\" style=\"color:#393A34\">}</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p>Don't ask me how my laptop haven’t gone through the window. But there you have it — enjoy your newfound freedom <!-- -->:P</p>",
            "url": "https://magmanu.github.io/blog/tech/terraform-ternary-error",
            "title": "Bypassing Terraform error: “The true and false result expressions must have consistent types”",
            "summary": "Have you ever came across this Terraform error — when you intentionally want your ternary to output different types?",
            "date_modified": "2023-03-18T00:00:00.000Z",
            "author": {
                "name": "Manu Magalhães",
                "url": "https://github.com/magmanu"
            },
            "tags": [
                "infra",
                "terraform",
                "workarounds",
                "devops"
            ]
        },
        {
            "id": "https://magmanu.github.io/blog/tech/migrate-codecommit-to-github",
            "content_html": "<p>This tutorial includes guidance for three different scenarios in your GitHub administration:</p>\n<ol>\n<li>when your repo is in your personal account;</li>\n<li>when your app is under a GitHub Org and admins grant you the permissions you need; and</li>\n<li>when your repo is under a GitHub Org and admins do NOT grant you the permissions you need.</li>\n</ol>\n<p><em>Pre-requisites: Relevant access and permissions for CodeCommit and Amplify. You also need a working GitHub account.</em></p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"migrating-your-repo\">Migrating Your Repo<a href=\"https://magmanu.github.io/blog/tech/migrate-codecommit-to-github#migrating-your-repo\" class=\"hash-link\" aria-label=\"Direct link to Migrating Your Repo\" title=\"Direct link to Migrating Your Repo\">​</a></h2>\n<ol>\n<li>Open your CLI and cd into your existing CodeCommit local folder.</li>\n<li>Run <code>git remote get-url origin</code> to get the external clone URL for the project you plan to migrate to GitHub.</li>\n<li>Create a temporary folder by running <code>mkdir ../temp-migration</code> and open it in the CLI by running <code>cd ../temp-migration</code>.</li>\n<li>Run <code>git clone --bare</code> followed by the clone URL you got in step 2. An example would be <code>git clone --bare &lt;https://git-codecommit.eu-west-1.amazonaws.com/v1/repos/name-of-your-codecommit-directory&gt;</code>.</li>\n</ol>\n<br>\n<div class=\"theme-admonition theme-admonition-note admonition_xJq3 alert alert--secondary\"><div class=\"admonitionHeading_Gvgb\"><span class=\"admonitionIcon_Rf37\"><svg viewBox=\"0 0 14 16\"><path fill-rule=\"evenodd\" d=\"M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z\"></path></svg></span>Educational note</div><div class=\"admonitionContent_BuS1\"><p>The flag <code>--bare</code> is a way to fully clone your repo while cutting all its ties with the remote (in CodeCommit, in this case). You still get all your branches, tags and everything, but the cloned repo is completely independent from the remote.</p></div></div>\n<br>\n<ol start=\"5\">\n<li>Create a new GitHub repo. To prevent issues, don’t add any README, .gitignore or anything. After you click “Create repo”, the only thing you should do is to copy the external clone URL as shown below. Don’t run any git init, fist commit or anything. Just copy the relevant path as shown below.</li>\n</ol>\n<br>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Git clone SSH\" src=\"https://magmanu.github.io/blog/assets/images/clone_ssh-5be730cf4d2ec7e3548855fc55af9e16.webp\" width=\"1400\" height=\"508\" class=\"img_ev3q\"></p>\n<br>\n<ol start=\"6\">\n<li>Back to your terminal, cd into your bare git repo by running <code>cd name-of-your-codecommit-directory.git</code> and run <code>git push --mirror</code> followed by the clone path you got in step 5. In my case, it will be <code>git push --mirror &lt;https://github.com/my-username/my-project.git&gt;</code>.</li>\n</ol>\n<p>That’s it, migration is complete now.</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"confirm\">Confirm<a href=\"https://magmanu.github.io/blog/tech/migrate-codecommit-to-github#confirm\" class=\"hash-link\" aria-label=\"Direct link to Confirm\" title=\"Direct link to Confirm\">​</a></h3>\n<p>To confirm all went well, go back to GitHub and refresh the page. You’ll see that your repo will be there as expected, including all your commit history, branches and everything. To start working on your migrated GitHub repo, simply clone it and get on with business as usual :)</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"clean-up\">Clean up<a href=\"https://magmanu.github.io/blog/tech/migrate-codecommit-to-github#clean-up\" class=\"hash-link\" aria-label=\"Direct link to Clean up\" title=\"Direct link to Clean up\">​</a></h3>\n<p>If you followed the instructions strictly, now it’s time to delete your temporary folder. Go back to your terminal and run <code>cd ../.. and rm -rf temp-migration</code>. If you used your OS’s tmp folder instead, skip this step.</p>\n<h2 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"rewiring-your-amplify-pipeline\">Rewiring your Amplify Pipeline<a href=\"https://magmanu.github.io/blog/tech/migrate-codecommit-to-github#rewiring-your-amplify-pipeline\" class=\"hash-link\" aria-label=\"Direct link to Rewiring your Amplify Pipeline\" title=\"Direct link to Rewiring your Amplify Pipeline\">​</a></h2>\n<p>Now that you migrated the code to GitHub, how do you leverage your already existing Amplify pipeline that was linked to the CodeCommit repo?</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"run--the-update-app-command\">Run  the <code>update-app</code> command<a href=\"https://magmanu.github.io/blog/tech/migrate-codecommit-to-github#run--the-update-app-command\" class=\"hash-link\" aria-label=\"Direct link to run--the-update-app-command\" title=\"Direct link to run--the-update-app-command\">​</a></h3>\n<div class=\"language-bash codeBlockContainer_Ckt0 theme-code-block\" style=\"--prism-color:#393A34;--prism-background-color:#f6f8fa\"><div class=\"codeBlockContent_biex\"><pre tabindex=\"0\" class=\"prism-code language-bash codeBlock_bY9V thin-scrollbar\" style=\"color:#393A34;background-color:#f6f8fa\"><code class=\"codeBlockLines_e6Vv\"><span class=\"token-line\" style=\"color:#393A34\"><span class=\"token assign-left variable\" style=\"color:#36acaa\">AWS_PROFILE</span><span class=\"token operator\" style=\"color:#393A34\">=</span><span class=\"token plain\">YOUR_PROFILE </span><span class=\"token assign-left variable\" style=\"color:#36acaa\">AWS_DEFAULT_REGION</span><span class=\"token operator\" style=\"color:#393A34\">=</span><span class=\"token plain\">YOUR_REGION aws amplify update-app --app-id AMPLIFY_APP_ID </span><span class=\"token parameter variable\" style=\"color:#36acaa\">--repository</span><span class=\"token plain\"> REPOSITORY_URL --access-token ACCESS_TOKEN</span><br></span></code></pre><div class=\"buttonGroup__atx\"><button type=\"button\" aria-label=\"Copy code to clipboard\" title=\"Copy\" class=\"clean-btn\"><span class=\"copyButtonIcons_eSgA\" aria-hidden=\"true\"><svg viewBox=\"0 0 24 24\" class=\"copyButtonIcon_y97N\"><path fill=\"currentColor\" d=\"M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z\"></path></svg><svg viewBox=\"0 0 24 24\" class=\"copyButtonSuccessIcon_LjdS\"><path fill=\"currentColor\" d=\"M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z\"></path></svg></span></button></div></div></div>\n<p><code>AMPLIFY_APP_ID</code>: To find your app id, go to the Amplify console. Under App settings, click General and look for the App ARN. The app id should be the alphanumeric string at the very end of the ARN. You can find it in your Amplify console: App settings &gt; General. The id is shown as “REDACTED” in the screenshot below:</p>\n<br>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Amplify App Id\" src=\"https://magmanu.github.io/blog/assets/images/amplify_data-ed02eb0516b95e7d3782a0b619920733.webp\" width=\"1400\" height=\"459\" class=\"img_ev3q\"></p>\n<br>\n<p><code>REPOSITORY_URL</code>: It’s the one you got in the step 5 of the migration.\n<code>ACCESS_TOKEN</code>: The access token is s a Personal Access Token that you can generate in GitHub. Beware that this token has to be generated by the GitHub repo owner.</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"re-authenticate-your-amplify-app\">Re-authenticate your Amplify app<a href=\"https://magmanu.github.io/blog/tech/migrate-codecommit-to-github#re-authenticate-your-amplify-app\" class=\"hash-link\" aria-label=\"Direct link to Re-authenticate your Amplify app\" title=\"Direct link to Re-authenticate your Amplify app\">​</a></h3>\n<div class=\"theme-admonition theme-admonition-tip admonition_xJq3 alert alert--success\"><div class=\"admonitionHeading_Gvgb\"><span class=\"admonitionIcon_Rf37\"><svg viewBox=\"0 0 12 16\"><path fill-rule=\"evenodd\" d=\"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z\"></path></svg></span>Real life XP</div><div class=\"admonitionContent_BuS1\"><p>Companies can be very strict about the GitHub Apps they approve. If you get blocked because your admins, for whatever reason, won't approve the Amplify App, jump to the section <a href=\"https://magmanu.github.io/blog/tech/migrate-codecommit-to-github#the-webhook-approach\">\"The Webhook Approach\"</a>.</p></div></div>\n<p>Now you can reconnect your app. In the same page you got your ARN, if you look above the ARN you’ll find a button “Reconnect repository”. When you click it, you’ll be directed to the Oath flow in GitHub.</p>\n<ul>\n<li><strong>If the migrated repo is NOT under an Organization</strong>, you can click the “Authorize aws-amplify-console” button. You’ll be redirected to the Amplify console, and once there, click again the reconnect repository, select the relevant repo and off you go! Enjoy!</li>\n<li><strong>If the migrated repo is under your Organization</strong>, you can request the OAuth permission to the Amplify App by clicking a button. It will show a request pending message until your admin approves it (you’ll receive an email when they do).</li>\n</ul>\n<br>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Authorize Amplify Github App\" src=\"https://magmanu.github.io/blog/assets/images/authorize_amplify_app-0c09d0e0746dd8ee0e5bf2f70539c74a.webp\" width=\"1186\" height=\"1206\" class=\"img_ev3q\"></p>\n<br>\n<p>Once Oauth is granted, go back to your Amplify app and click Reconnect repository again. You'll be shown repos both from your org and from your own account to choose from. Select the relevant one and have fun with your new migrated repos!</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"the-webhook-approach\">The Webhook Approach<a href=\"https://magmanu.github.io/blog/tech/migrate-codecommit-to-github#the-webhook-approach\" class=\"hash-link\" aria-label=\"Direct link to The Webhook Approach\" title=\"Direct link to The Webhook Approach\">​</a></h3>\n<p>An alternative to using the Amplify GitHub App is to create an incoming webhook in Amplify instead.\nTo do that, under App settings, select Build settings nd click Create Webhook (both shown in orange below).</p>\n<br>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Amplify Build Settings\" src=\"https://magmanu.github.io/blog/assets/images/amplify_build_settings-937fb3f3220996941f487bd5ed440afe.webp\" width=\"1181\" height=\"295\" class=\"img_ev3q\"></p>\n<br>\n<p>In the pop-up, type in a name and select a branch to build. Your new webhook will show in the Amplify interface. Copy its URL, we’ll use it in GitHub.</p>\n<br>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Amplify Incming Webhooks\" src=\"https://magmanu.github.io/blog/assets/images/amplify_incoming_webhooks-e4c6bd369f275c88df521b33d531b072.webp\" width=\"769\" height=\"234\" class=\"img_ev3q\"></p>\n<br>\n<p>Now go back to your migrated GitHub repo, select Settings &gt; Webhooks and click the button Add webhook.</p>\n<br>\n<p><img decoding=\"async\" loading=\"lazy\" alt=\"Adding GitHub Webhooks\" src=\"https://magmanu.github.io/blog/assets/images/github_webhooks-143154a73be16465c0004e7d5de274d3.webp\" width=\"1264\" height=\"868\" class=\"img_ev3q\"></p>\n<p>Workaround completed.</p>\n<h3 class=\"anchor anchorWithHideOnScrollNavbar_WYt5\" id=\"caveats-of-the-webhook-approach\">Caveats of the Webhook Approach<a href=\"https://magmanu.github.io/blog/tech/migrate-codecommit-to-github#caveats-of-the-webhook-approach\" class=\"hash-link\" aria-label=\"Direct link to Caveats of the Webhook Approach\" title=\"Direct link to Caveats of the Webhook Approach\">​</a></h3>\n<p>If you go down the webhook path, be mindful that:</p>\n<ul>\n<li>If you need to connect multiple branches to Amplify, you need to create a webhook in Amplify to each of them, and add each to GitHub, one by one. If you feel tempted to automate it, have a chat to your GitHub Org admin to clear up how the OAuth permission for the Amplify App can be done. Automation in this end is an overkill and waste of time.</li>\n<li>Any git push will trigger the webhook in every single frontend deployment in your Amplify. In other words, if you have the branches “main”, “release”, “dev”, “feature/a”, and “feature/b”, every time your colleague pushes his changes in “feature/b” to GitHub, the pipeline will be triggered for all the five branches.</li>\n</ul>\n<p>Hope this was helpful, see you!</p>",
            "url": "https://magmanu.github.io/blog/tech/migrate-codecommit-to-github",
            "title": "How to Migrate CodeCommit to GitHub — and Keep your Amplify Pipeline",
            "summary": "This tutorial includes guidance for three different scenarios in your GitHub administration:",
            "date_modified": "2021-10-13T00:00:00.000Z",
            "author": {
                "name": "Manu Magalhães",
                "url": "https://github.com/magmanu"
            },
            "tags": [
                "infra",
                "github",
                "amplify",
                "aws",
                "ci/cd",
                "tutorial"
            ]
        }
    ]
}